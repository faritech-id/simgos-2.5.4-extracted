USE `inventory`;

DROP FUNCTION IF EXISTS `getHrgDasarBarang`;
DELIMITER //
CREATE DEFINER=`root`@`localhost` FUNCTION `getHrgDasarBarang`(`PBARANG` INT, `PTANGGAL` DATE) RETURNS decimal(60,2)
    DETERMINISTIC
BEGIN
	DECLARE VHARGA DECIMAL(60,2);
	
	SELECT HARGA_JUAL INTO VHARGA 
	  FROM `inventory`.harga_barang
	 WHERE BARANG = PBARANG AND MASA_BERLAKU <= PTANGGAL
	  
	 ORDER BY MASA_BERLAKU DESC, ID DESC LIMIT 1;
	 
	IF VHARGA > 0 THEN
		RETURN VHARGA;
	ELSE
		RETURN 0;
	END IF;
END//
DELIMITER ;