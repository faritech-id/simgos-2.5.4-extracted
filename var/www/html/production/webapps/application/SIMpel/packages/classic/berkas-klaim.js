Ext.define("berkas.klaim.Model",{extend:"data.model.Model",serviceName:"berkas-klaim",fields:[{name:"NOMOR",type:"string"}],idProperty:"NOMOR"});Ext.define("berkas.klaim.farmasi.Model",{extend:"data.model.Model",serviceName:"berkas-klaim/farmasi",cacheString:""});Ext.define("berkas.klaim.farmasi.Store",{extend:"data.store.Store",model:"berkas.klaim.farmasi.Model",alias:"store.berkas-klaim-farmasi-store"});Ext.define("berkas.klaim.kunjungan.Model",{extend:"data.model.Model",serviceName:"berkas-klaim/kunjungan",noCache:false});Ext.define("berkas.klaim.kunjungan.Store",{extend:"data.store.Store",model:"berkas.klaim.kunjungan.Model",alias:"store.berkas-klaim-kunjungan-store"});Ext.define("berkas.klaim.obat.dokumenpendukung.Model",{extend:"data.model.Model",serviceName:"berkasklaim/dokumenpendukung",fields:[{name:"ID",type:"int"},{name:"BERKAS",type:"int"},{name:"DESKRIPSI",type:"string"},{name:"DOKUMEN_PENDUKUNG",type:"string"},{name:"TANGGAL",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"STATUS",type:"int"}],idProperty:"ID"});Ext.define("berkas.klaim.obat.dokumenpendukung.Store",{extend:"data.store.Store",model:"berkas.klaim.obat.dokumenpendukung.Model",alias:"store.berkas-klaim-obat-dokumenpendukung-store"});Ext.define("berkas.klaim.obat.farmasi.Model",{extend:"data.model.Model",serviceName:"berkasklaim/obatfarmasi",fields:[{name:"ID",type:"int"},{name:"PENDAFTARAN",type:"string"},{name:"NOSEP",type:"string"},{name:"TANGGAL",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"OLEH",type:"int"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("berkas.klaim.obat.farmasi.Store",{extend:"data.store.Store",model:"berkas.klaim.obat.farmasi.Model",alias:"store.berkas-klaim-obat-farmasi-store"});Ext.define("berkas.klaim.obat.farmasi.detil.Model",{extend:"data.model.Model",serviceName:"berkasklaim/obatfarmasidetil",fields:[{name:"ID",type:"int"},{name:"OBAT_FARMASI",type:"int"},{name:"KUNJUNGAN",type:"string"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("berkas.klaim.obat.farmasi.detil.Store",{extend:"data.store.Store",model:"berkas.klaim.obat.farmasi.detil.Model",alias:"store.berkas-klaim-obat-farmasi-detil-store"});Ext.define("berkas.klaim.obat.labklinik.Model",{extend:"data.model.Model",serviceName:"berkasklaim/labklinik",fields:[{name:"ID",type:"int"},{name:"NORM",type:"int"},{name:"NOSEP",type:"string"},{name:"TANGGAL",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"OLEH",type:"int"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("berkas.klaim.obat.labklinik.Store",{extend:"data.store.Store",model:"berkas.klaim.obat.labklinik.Model",alias:"store.berkas-klaim-obat-labklinik-store"});Ext.define("berkas.klaim.obat.labklinik.detil.Model",{extend:"data.model.Model",serviceName:"berkasklaim/labklinikdetil",fields:[{name:"ID",type:"int"},{name:"LAB_KLINIK",type:"int"},{name:"HASIL_LAB",type:"string"},{name:"TINDAKAN_MEDIS",type:"string"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("berkas.klaim.obat.labklinik.detil.Store",{extend:"data.store.Store",model:"berkas.klaim.obat.labklinik.detil.Model",alias:"store.berkas-klaim-obat-labklinik-detil-store"});Ext.define("berkas.klaim.obat.labpa.Model",{extend:"data.model.Model",serviceName:"berkasklaim/patologianatomi",fields:[{name:"ID",type:"int"},{name:"NORM",type:"int"},{name:"NOSEP",type:"string"},{name:"TANGGAL",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"OLEH",type:"int"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("berkas.klaim.obat.labpa.Store",{extend:"data.store.Store",model:"berkas.klaim.obat.labpa.Model",alias:"store.berkas-klaim-obat-labpa-store"});Ext.define("berkas.klaim.obat.labpa.detil.Model",{extend:"data.model.Model",serviceName:"berkasklaim/patologianatomidetil",fields:[{name:"ID",type:"int"},{name:"PATOLOGI_ANATOMI",type:"int"},{name:"HASIL_PA",type:"int"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("berkas.klaim.obat.labpa.detil.Store",{extend:"data.store.Store",model:"berkas.klaim.obat.labpa.detil.Model",alias:"store.berkas-klaim-obat-labpa-detil-store"});Ext.define("berkas.klaim.obat.radiologi.Model",{extend:"data.model.Model",serviceName:"berkasklaim/radiologi",fields:[{name:"ID",type:"int"},{name:"NORM",type:"int"},{name:"NOSEP",type:"string"},{name:"TANGGAL",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"OLEH",type:"int"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("berkas.klaim.obat.radiologi.Store",{extend:"data.store.Store",model:"berkas.klaim.obat.radiologi.Model",alias:"store.berkas-klaim-obat-radiologi-store"});Ext.define("berkas.klaim.obat.radiologi.detil.Model",{extend:"data.model.Model",serviceName:"berkasklaim/radiologidetil",fields:[{name:"ID",type:"int"},{name:"RADIOLOGI",type:"int"},{name:"HASIL_RAD",type:"int"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("berkas.klaim.obat.radiologi.detil.Store",{extend:"data.store.Store",model:"berkas.klaim.obat.radiologi.detil.Model",alias:"store.berkas-klaim-obat-radiologi-detil-store"});Ext.define("berkas.klaim.pemeriksaan.Model",{extend:"data.model.Model",serviceName:"berkas-klaim/pemeriksaan",cacheString:""});Ext.define("berkas.klaim.pemeriksaan.Store",{extend:"data.store.Store",model:"berkas.klaim.pemeriksaan.Model",alias:"store.berkas-klaim-pemeriksaan-store"});Ext.define("berkas.klaim.pendukung.Model",{extend:"data.model.Model",serviceName:"berkas-klaim/daftarDokumenPendukung",cacheString:""});Ext.define("berkas.klaim.pendukung.Store",{extend:"data.store.Store",model:"berkas.klaim.pendukung.Model",alias:"store.berkas-klaim-pendukung-store"});Ext.define("berkas.klaim.Pencarian",{extend:"com.Form",xtype:"berkas-klaim-pencarian",controller:"berkas-klaim-pencarian",layout:{type:"hbox",align:"stretch"},bodyPadding:0,items:[{xtype:"search-field",cls:"x-text-border",iconCls:"iconSearch",autoFocus:true,emptyText:"Masukan Nomor SEP",reference:"cari_text",enableKeyEvents:true,flex:1,listeners:{search:"onSearch",change:"onChange"}}]});Ext.define("berkas.klaim.PencarianController",{extend:"Ext.app.ViewController",alias:"controller.berkas-klaim-pencarian",onSearch:function(){this.doCari()},doCari:function(){var c=this,a=c.getView(),b=c.getReferences(),d=b.cari_text.getValue();if(d.trim().length==0){return}c.cariNomor(d).then(function(e){a.fireEvent("opentab",e,"fas fa-file-alt",true,"berkas.klaim.Workspace","berkas-klaim-"+e.get("NOMOR"),e.get("NOMOR"))},function(e){a.notifyMessage(e)})},onChange:function(c,e){var d=this,a=d.getView(),b=a.down("search-field");if(e==""){b.onClearClick()}},privates:{cariNomor:function(b){var a=new Ext.Deferred();berkas.klaim.Model.load(b,{callback:function(c,e,i){if(i){a.resolve(c)}else{if(e.hasException()){var f=e.getError(),h=f?f.response.responseText:e.getResponse().responseText,d=Ext.JSON.decode(h),g=d.detail?(Ext.isObject(d.detail)?Ext.JSON.encode(d.detail):d.detail):"Koneksi Gagal";a.reject(g)}else{a.reject("Berkas tidak ditemukan")}}}});return a.promise}}});Ext.define("berkas.klaim.Service",{extend:"com.Service",serviceName:"berkas-klaim",laporan:function(b,a,c){this.request("laporan?KUNJUNGAN="+b+"&TINDAKAN="+a,"GET","",c)}});Ext.define("berkas.klaim.Workspace",{extend:"com.Form",xtype:"berkas-klaim-workspace",controller:"berkas-klaim-workspace",layout:{type:"vbox",align:"stretch"},items:[{xtype:"berkas-klaim-pasien-form",height:160,bbar:["->",{xtype:"button",ui:"soft-blue",iconCls:"x-fa fa-envelope",text:"SEP",handler:"onSEP"},{xtype:"button",ui:"soft-cyan",iconCls:"x-fa fa-user",text:"Individual",handler:"onIndividual"},{xtype:"button",ui:"soft-green",iconCls:"x-fa fa-file-alt",text:"Resume Medis",handler:"onResume"},{xtype:"button",ui:"soft-gray",iconCls:"fas fa-receipt",text:"Billing",handler:"onBiling"},"->"]},{xtype:"container",layout:"border",flex:1,items:[{region:"west",ui:"panel-blue",xtype:"berkas-klaim-kunjungan-grid",width:385,split:{size:3},listeners:{select:"onSelectKunjungan"}},{region:"center",layout:"card",xtype:"container",reference:"container-item",items:[{ui:"panel-gray",xtype:"berkas-klaim-pemeriksaan-grid"},{ui:"panel-gray",xtype:"berkas-klaim-farmasi-grid"}]},{region:"east",ui:"panel-green",xtype:"berkas-klaim-pendukung-grid",width:385,collapsible:true,collapsed:true,split:{size:3}}]}],listeners:{afterrender:"onAfterRender"}});Ext.define("berkas.klaim.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.berkas-klaim-workspace",onAfterRender:function(){var e=this,c=e.getViewModel(),h=c.get("record"),a=e.getView(),b=a.down("berkas-klaim-kunjungan-grid"),d=a.down("berkas-klaim-pendukung-grid"),f=a.getReferensi(h.getData(),"TAGIHAN"),g={NOPEN:h.get("NOPEN")};b.setGridConfig({paging:true});if(f){g.TAGIHAN=f.NOMOR}b.load(g);d.load({no_klaim:h.get("NOMOR")})},onSelectKunjungan:function(e,h){var f=this,c=f.getView(),b=c.down("[reference=container-item]"),g=b.getLayout().getActiveItem();if(h.get("JENIS_KUNJUNGAN")==11){var a=b.getLayout().setActiveItem(1);if(!a){a=g}a.setGridConfig({paging:true});a.kunjungan=h;a.load({KUNJUNGAN:h.get("NOMOR")});return}var d=b.getLayout().setActiveItem(0);if(!d){d=g}d.setGridConfig({paging:true});d.kunjungan=h;d.load({KUNJUNGAN:h.get("NOMOR")})},onSEP:function(){var c=this,a=c.getView(),b=c.getViewModel(),d=b.get("record");if(d.get("JENIS")==2){a.cetak({NAME:"bpjs.CetakSEP",TYPE:"Pdf",EXT:"pdf",PARAMETER:{PSEP:d.get("NOMOR"),CETAK_HEADER:1},REQUEST_FOR_PRINT:false,PRINT_NAME:"CetakSEP"},function(e){a.printPreview("SEP",e)})}},onIndividual:function(){var c=this,a=c.getView(),b=c.getViewModel(),f=b.get("record"),e=a.getReferensi(f.getData(),"KELAS_KLAIM"),d=3;if(e){if(e.ID==3){d=1}if(e.ID==2){d=2}}a.cetak({NAME:"inacbg.CetakLapIndividual5",TYPE:"Pdf",EXT:"pdf",PARAMETER:{PNOPEN:f.get("NOPEN"),PKELAS:d,CETAK_HEADER:1},REQUEST_FOR_PRINT:false,PRINT_NAME:"CetakMR"},function(g){a.printPreview("LAPORAN INDIVIDUAL",g)})},onResume:function(){var c=this,a=c.getView(),b=c.getViewModel(),d=b.get("record");a.cetak({TITLE:"RESUME MEDIS",NAME:"mr.CetakMR2ResumeMedis",TYPE:"Pdf",EXT:"pdf",PARAMETER:{PNOPEN:d.get("NOPEN")},FINAL:1,DOCUMENT_STORAGE:{REF_ID:d.get("NOPEN"),DOCUMENT_DIRECTORY_ID:2},REQUEST_FOR_PRINT:false,PRINT_NAME:"CetakMR"})},onBiling:function(){var c=this,a=c.getView(),b=c.getViewModel(),e=b.get("record"),d=a.getReferensi(e.getData(),"TAGIHAN");a.cetak({NAME:"pembayaran.CetakRincianPasienPerGroup",TYPE:"Pdf",EXT:"pdf",PARAMETER:{PTAGIHAN:d.NOMOR,PKASIR:a.app.usrNm,PSTATUS:1},REQUEST_FOR_PRINT:false,PRINT_NAME:"CetakRincian"},function(f){a.printPreview("Cetak Rincian Tagihan",f)})}});Ext.define("berkas.klaim.farmasi.Grid",{extend:"com.Grid",alias:"widget.berkas-klaim-farmasi-grid",controller:"berkas-klaim-farmasi-grid",viewModel:{data:{listConfig:{resep:false}},stores:{store:{type:"berkas-klaim-farmasi-store",pageSize:300}}},title:"Daftar Obat / Alkes",iconCls:"fas fa-pills",header:{height:37,items:[{xtype:"button",text:"Resep",ui:"soft-cerulen",handler:"onResep"}]},kunjungan:undefined,bufferedRenderer:false,columns:[{xtype:"templatecolumn",flex:1,tpl:new Ext.XTemplate('<div style="font-size: 14px; font-weight: bold; white-space:normal !important;">{[this.getReferensi(values, "FARMASI", "NAMA")]}</div><div style="font-size: 12px; white-space:normal !important;">Ket: {KETERANGAN}</div><div style="font-size: 12px; white-space:normal !important;">Jml: {[this.numberFormat(values.JUMLAH)]} | Signa 1: {SIGNA1} | Signa2 : {SIGNA2} | Hari: {HARI} </div><div style="font-size: 12px; white-space:normal !important;">{[this.tanggalFormat(values.TANGGAL)]}</div>')}],onBeforeLoad:function(c,b,a){var d={STATUS:2};c.setParams(d)}});Ext.define("berkas.klaim.farmasi.GridController",{extend:"Ext.app.ViewController",alias:"controller.berkas-klaim-farmasi-grid",onResep:function(b){var c=this,a=c.getView(),d=a.kunjungan;if(d){a.cetak({TITLE:"RESEP DOKTER - "+d.get("REF"),NAME:"layanan.farmasi.CetakCopyResep",FINAL:1,DOCUMENT_STORAGE:{REF_ID:d.get("REF"),DOCUMENT_DIRECTORY_ID:15},TYPE:"Pdf",EXT:"pdf",PARAMETER:{PNOMOR:d.get("REF"),CETAK_HEADER:1},REQUEST_FOR_PRINT:false,PRINT_NAME:"CetakResep"})}}});Ext.define("berkas.klaim.kunjungan.Grid",{extend:"com.Grid",alias:"widget.berkas-klaim-kunjungan-grid",controller:"berkas-klaim-kunjungan-grid",viewModel:{stores:{store:{type:"berkas-klaim-kunjungan-store",pageSize:100}}},title:"Daftar Kunjungan",iconCls:"x-fa fa-list",header:{items:[{xtype:"button",iconCls:"x-fa fa-bars",ui:"soft-green",tooltip:"Pilihan",arrowVisible:false,menu:[{text:"Filter",iconCls:"x-fa fa-filter",menu:[{xtype:"referensi-combo",reference:"filterjenis",params:{JENIS:15,STATUS:1},emptyText:"Pilih Jenis Kunjungan",margin:5,listeners:{select:"onSelectJenisKunjungan"}}]}]}]},columns:[{xtype:"templatecolumn",tpl:new Ext.XTemplate("<div>",'<div style="font-size: 16px; font-weight: bold; white-space:normal !important;">{[this.getReferensi(values, "RUANGAN", "DESKRIPSI")]}</div>',"{[this.getInfoKamar(values)]}","{[this.getInfoTitipan(values)]}",'<div style="font-size: 12px; white-space:normal !important;">{[this.getReferensi(this.getReferensi(values, "RUANGAN"), "JENIS_KUNJUNGAN", "DESKRIPSI")]}</div>','<div style="font-size: 12px; white-space:normal !important;">Masuk: {[this.tanggalFormat(values.MASUK)]} | Keluar: {[this.tanggalFormat(values.KELUAR)]}</div>','<div style="font-size: 13px; white-space:normal !important;">Pendaftaran: {NOPEN} - {[this.tanggalFormat(values.REFERENSI.PENDAFTARAN.TANGGAL)]}</div>',"</div>",{getInfoKamar:function(c){var d=this.getReferensi(c,"RUANG_KAMAR_TIDUR"),e=this.getReferensi(d,"RUANG_KAMAR"),b=this.getReferensi(e,"KELAS","DESKRIPSI"),a="";if(e){a+=e.KAMAR+" / "}if(d){a+=d.TEMPAT_TIDUR+" / "}a+=b;return a!=""?'<div style="font-size: 12px; white-space:normal !important;">'+a+"</div>":""},getInfoTitipan:function(b){var c=this.getReferensi(b,"TITIPAN_KELAS","DESKRIPSI"),a="";if(c){a+="Pasien Titipan "+c}return a!=""?'<div style="white-space:normal !important;">'+a+"</div>":""}}),flex:1},{xtype:"widgetcolumn",widget:{xtype:"fieldcontainer",defaultType:"button",layout:{type:"vbox",align:"stretch"},defaults:{padding:2},items:[{text:"Pengkajian<br>Awal",ui:"soft-gray",action:0,handler:"onAwal"},{text:"Pengkajian<br>Harian",ui:"soft-green",action:1,handler:"onHarian"}]},onWidgetAttach:"onWidgetAttach"}],onBeforeLoad:function(d,c,b){var a=d.down("[reference=filterjenis]"),e={STATUS:2};d.setParams(e);if(a){a.load(function(g,f,h){if(h){if(g.length>0){g[0].set("DESKRIPSI","Semua Kunjungan")}}})}}});Ext.define("berkas.klaim.kunjungan.GridController",{extend:"Ext.app.ViewController",alias:"controller.berkas-klaim-kunjungan-grid",init:function(){this.filter={jenisKunjungan:0}},onSelectJenisKunjungan:function(a,c){var b=this;b.filter.jenisKunjungan=0;if(c){b.filter.jenisKunjungan=c.get("ID")}b.doFilterJenisKunjungan()},onWidgetAttach:function(c,e,f){var a=e.down("[action=0]"),g=e.down("[action=1]"),b=(f.get("JENIS_KUNJUNGAN")==4||f.get("JENIS_KUNJUNGAN")==5||f.get("JENIS_KUNJUNGAN")==11),d=(f.get("JENIS_KUNJUNGAN")==2||f.get("JENIS_KUNJUNGAN")==4||f.get("JENIS_KUNJUNGAN")==5||f.get("JENIS_KUNJUNGAN")==11);a.setHidden(f.get("BARU")==0||b);g.setHidden(f.get("BARU")==1||d)},onAwal:function(b){var c=this,a=c.getView(),d=b.ownerCt.getWidgetRecord();a.cetak({TITLE:"PENGKAJIAN AWAL",NAME:"mr.PengkajianAwal"+d.get("JENIS_KUNJUNGAN"),TYPE:"Pdf",EXT:"pdf",FINAL:1,DOCUMENT_STORAGE:{REF_ID:d.get("NOPEN"),DOCUMENT_DIRECTORY_ID:12},PARAMETER:{PNOPEN:d.get("NOPEN"),PKUNJUNGAN:d.get("NOMOR"),CETAK_HEADER:1},PRINT_NAME:"CetakMR"})},onHarian:function(b){var c=this,a=c.getView(),d=b.ownerCt.getWidgetRecord();a.cetak({TITLE:"PENGKAJIAN HARIAN",NAME:"mr.PengkajianHarian",TYPE:"Pdf",EXT:"pdf",FINAL:1,DOCUMENT_STORAGE:{REF_ID:d.get("NOPEN"),DOCUMENT_DIRECTORY_ID:13},PARAMETER:{PNOPEN:d.get("NOPEN"),PKUNJUNGAN:d.get("NOMOR"),CETAK_HEADER:1},PRINT_NAME:"CetakMR"})},privates:{doFilterJenisKunjungan:function(){var c=this,a=c.getView(),b=a.down("pagingtoolbar"),d={};if(c.filter.jenisKunjungan==0){delete a.getParams().JENIS_KUNJUNGAN}else{d.JENIS_KUNJUNGAN=c.filter.jenisKunjungan}a.setParams(d);if(b){b.moveFirst()}else{a.load()}}}});Ext.define("berkas.klaim.obat.Pencarian",{extend:"com.Form",xtype:"berkas-klaim-obat-pencarian",controller:"berkas-klaim-obat-pencarian",layout:{type:"hbox",align:"stretch"},bodyPadding:0,items:[{xtype:"search-field",cls:"x-text-border",iconCls:"iconSearch",autoFocus:true,emptyText:"Masukan Nomor SEP",reference:"cari_text",enableKeyEvents:true,flex:1,listeners:{search:"onSearch",change:"onChange"}}]});Ext.define("berkas.klaim.obat.PencarianController",{extend:"Ext.app.ViewController",alias:"controller.berkas-klaim-obat-pencarian",onSearch:function(){this.doCari()},doCari:function(){var c=this,a=c.getView(),b=c.getReferences(),d=b.cari_text.getValue();wrkspace=Ext.create("berkas.klaim.obat.Workspace");if(d.trim().length==0){return}c.cariNomor(d).then(function(e){a.fireEvent("opentab",e,"fas fa-file-alt",true,"berkas.klaim.obat.Workspace","berkas-klaim-obat-"+e.get("NOMOR"),e.get("NOMOR"));wrkspace.loadRecord(e)},function(e){a.notifyMessage(e)})},onChange:function(c,e){var d=this,a=d.getView(),b=a.down("search-field");if(e==""){b.onClearClick()}},privates:{cariNomor:function(b){var a=new Ext.Deferred();berkas.klaim.Model.load(b,{callback:function(c,e,i){if(i){a.resolve(c)}else{if(e.hasException()){var f=e.getError(),h=f?f.response.responseText:e.getResponse().responseText,d=Ext.JSON.decode(h),g=d.detail?(Ext.isObject(d.detail)?Ext.JSON.encode(d.detail):d.detail):"Koneksi Gagal";a.reject(g)}else{a.reject("Berkas tidak ditemukan")}}}});return a.promise}}});Ext.define("berkas.klaim.obat.Workspace",{extend:"com.Form",xtype:"berkas-klaim-obat-workspace",controller:"berkas-klaim-obat-workspace",viewModel:{stores:{berkasKlaimObatFarmasiStore:{type:"berkas-klaim-obat-farmasi-store"},berkasKlaimObatRadiologiStore:{type:"berkas-klaim-obat-radiologi-store"},berkasKlaimObatPaStore:{type:"berkas-klaim-obat-labpa-store"},berkasKlaimObatLabKlinikStore:{type:"berkas-klaim-obat-labklinik-store"}}},layout:{type:"vbox",align:"stretch"},items:[{xtype:"berkas-klaim-pasien-form",height:160,bbar:["->",{xtype:"button",ui:"soft-blue",iconCls:"x-fa fa-envelope",text:"SEP",handler:"onSEP"},{xtype:"button",ui:"soft-cyan",iconCls:"x-fa fa-user",text:"Individual",handler:"onIndividual"},{xtype:"button",ui:"soft-green",iconCls:"x-fa fa-file-alt",text:"Resume Medis",handler:"onResume"},{xtype:"button",ui:"soft-gray",iconCls:"fas fa-receipt",text:"Billing",handler:"onBiling"},"->"]},{xtype:"container",layout:"border",flex:1,items:[{region:"west",ui:"panel-blue",xtype:"berkas-klaim-obat-daftarberkas-grid",reference:"refberkasklaimobatdaftarberkasgrid",width:385,split:{size:3},listeners:{select:"onSelectDaftarBerkas"}},{region:"center",layout:"card",xtype:"container",reference:"container-item",items:[{ui:"panel-gray",xtype:"panel"},{ui:"panel-gray",xtype:"berkas-klaim-obat-farmasi-list",title:"Daftar Order"},{ui:"panel-gray",xtype:"berkas-klaim-obat-labklinik-listtindakan"},{ui:"panel-gray",xtype:"layanan-laboratorium-pa-list"},{ui:"panel-gray",xtype:"berkas-klaim-obat-radiologi-list"},{ui:"panel-gray",xtype:"panel"},{ui:"panel-gray",xtype:"berkas-klaim-obat-dokumenpendukung-workspace"}]}]}]});Ext.define("berkas.klaim.obat.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.berkas-klaim-obat-workspace",onSEP:function(){var c=this,a=c.getView(),b=c.getViewModel(),d=b.get("record");if(d.get("JENIS")==2){a.cetak({NAME:"bpjs.CetakSEP",TYPE:"Pdf",EXT:"pdf",PARAMETER:{PSEP:d.get("NOMOR"),CETAK_HEADER:1},REQUEST_FOR_PRINT:false,PRINT_NAME:"CetakSEP"},function(e){a.printPreview("SEP",e)})}},onIndividual:function(){var c=this,a=c.getView(),b=c.getViewModel(),f=b.get("record"),e=a.getReferensi(f.getData(),"KELAS_KLAIM"),d=3;if(e){if(e.ID==3){d=1}if(e.ID==2){d=2}}a.cetak({NAME:"inacbg.CetakLapIndividual5",TYPE:"Pdf",EXT:"pdf",PARAMETER:{PNOPEN:f.get("NOPEN"),PKELAS:d,CETAK_HEADER:1},REQUEST_FOR_PRINT:false,PRINT_NAME:"CetakMR"},function(g){a.printPreview("LAPORAN INDIVIDUAL",g)})},onResume:function(){var c=this,a=c.getView(),b=c.getViewModel(),d=b.get("record");a.cetak({TITLE:"RESUME MEDIS",NAME:"mr.CetakMR2ResumeMedis",TYPE:"Pdf",EXT:"pdf",PARAMETER:{PNOPEN:d.get("NOPEN")},FINAL:1,DOCUMENT_STORAGE:{REF_ID:d.get("NOPEN"),DOCUMENT_DIRECTORY_ID:2},REQUEST_FOR_PRINT:false,PRINT_NAME:"CetakMR"})},onBiling:function(){var c=this,a=c.getView(),b=c.getViewModel(),e=b.get("record"),d=a.getReferensi(e.getData(),"TAGIHAN");a.cetak({NAME:"pembayaran.CetakRincianPasienPerGroup",TYPE:"Pdf",EXT:"pdf",PARAMETER:{PTAGIHAN:d.NOMOR,PKASIR:a.app.usrNm,PSTATUS:1},REQUEST_FOR_PRINT:false,PRINT_NAME:"CetakRincian"},function(f){a.printPreview("Cetak Rincian Tagihan",f)})},onSelectDaftarBerkas:function(n,g){var l=this,c=l.getReferences(),d=l.getViewModel(),m=l.getView(),a=m.down("[reference=container-item]"),i=a.getLayout().getActiveItem();if(g.get("ID")==2){var b=a.getLayout().setActiveItem(2);if(!b){b=i}d.get("berkasKlaimObatLabKlinikStore").removeAll();d.get("berkasKlaimObatLabKlinikStore").queryParams={NOSEP:l.getView().getRecord().get("NOMOR")};d.get("berkasKlaimObatLabKlinikStore").load({callback:function(p,o,q){if(q){b.getViewModel().set("hideviewlabklinik",false);b.getViewModel().set("berkaslabklinik",true);b.setHideHeaders(false);b.loadDataTindakanMedisLK(l.getView().getRecord(),p[0],true,false)}}});return}if(g.get("ID")==3){var h=a.getLayout().setActiveItem(3);if(!h){h=i}d.get("berkasKlaimObatPaStore").removeAll();d.get("berkasKlaimObatPaStore").queryParams={NOSEP:l.getView().getRecord().get("NOMOR")};d.get("berkasKlaimObatPaStore").load({callback:function(p,o,q){if(q){h.setListConfig({paging:true});h.getViewModel().set("hideviewpa",false);h.getViewModel().set("berkaspa",false);h.setHideHeaders(false);h.loadDataBerkasKlaimObatPa(l.getView().getRecord(),p[0],false,false)}}});return}if(g.get("ID")==4){var f=a.getLayout().setActiveItem(4);if(!f){f=i}d.get("berkasKlaimObatRadiologiStore").removeAll();d.get("berkasKlaimObatRadiologiStore").queryParams={NOSEP:l.getView().getRecord().get("NOMOR")};d.get("berkasKlaimObatRadiologiStore").load({callback:function(p,o,q){if(q){f.setListConfig({paging:true});f.getViewModel().set("hideviewradiologi",false);f.getViewModel().set("berkasradiologi",false);f.setHideHeaders(false);f.loadDataBerkasKlaimObatRadiologi(l.getView().getRecord(),p[0],false,false)}}});return}if(g.get("ID")==1){var k=a.getLayout().setActiveItem(1);if(!k){k=i}d.get("berkasKlaimObatFarmasiStore").removeAll();d.get("berkasKlaimObatFarmasiStore").queryParams={PENDAFTARAN:l.getView().getRecord().get("NOPEN")};d.get("berkasKlaimObatFarmasiStore").load({callback:function(p,o,q){if(q){k.setGridConfig({paging:true});k.getViewModel().set("hideviewresep",false);k.loadBerkasKlaimObat(p[0],false)}}});return}if(g.get("ID")==5){var e=a.getLayout().setActiveItem(5);if(!e){e=i}return}if(g.get("ID")==6){var j=a.getLayout().setActiveItem(6);if(!j){j=i}j.load();return}}});Ext.define("berkas.klaim.obat.daftarberkas.Grid",{extend:"com.Grid",alias:"widget.berkas-klaim-obat-daftarberkas-grid",controller:"berkas-klaim-obat-daftarberkas-grid",viewModel:{stores:{store:{fields:["ID","DESKRIPSI"],data:[{ID:1,DESKRIPSI:"Farmasi",XTYPE:"berkas-klaim-obat-farmasi-workspace",TITLE:"Daftar Depo dan Order Obat Farmasi"},{ID:2,DESKRIPSI:"Laboratorium Klinik",XTYPE:"berkas-klaim-obat-labklinik-workspace",TITLE:"Hasil Laboratorium"},{ID:3,DESKRIPSI:"Tindakan Patologi Anatomi",XTYPE:"layanan-laboratorium-pa-workspace",TITLE:"Tindakan Patologi Anatomi"},{ID:4,DESKRIPSI:"Radiologi",XTYPE:"berkas-klaim-obat-radiologi-workspace",TITLE:"Tindakan Radiologi"},{ID:5,DESKRIPSI:"Protokol Pengobatan"},{ID:6,DESKRIPSI:"Dokumen Pendukung"}]}},data:{buttonObatFarmasi:true}},title:"Daftar Lampiran Berkas",iconCls:"x-fa fa-list",header:{padding:"10 5 10 5"},columns:[{xtype:"templatecolumn",tpl:new Ext.XTemplate("<div>",'<div style="font-size: 12px; font-weight: bold; white-space:normal !important; padding: 5px">{DESKRIPSI}</div>',"</div>"),flex:1},{xtype:"widgetcolumn",onWidgetAttach:"onWidgetAttach",widget:{xtype:"fieldcontainer",defaultType:"button",items:[{text:"Lihat",ui:"soft-blue",handler:"onLihat"}]},bind:{hidden:"{buttonObatFarmasi}"}}],listeners:{afterrender:"onAfterRender"}});Ext.define("berkas.klaim.obat.daftarberkas.GridController",{extend:"Ext.app.ViewController",alias:"controller.berkas-klaim-obat-daftarberkas-grid",onAfterRender:function(){var b=this,a=b.getViewModel(),c=b.getView().app.xpriv;allowIcd=c("2401010401",true);if(allowIcd){a.set("buttonObatFarmasi",false)}},onWidgetAttach:function(b,c,e){var d=this,a=c.items.items[0];a.setHidden(e.get("ID")==6)},onLihat:function(b){var d=this,a=d.getView(),c=d.getViewModel(),e=b.ownerCt.getWidgetRecord();if(e.get("XTYPE")){a.openDialog("",false,"100%","100%",{title:e.get("TITLE")?e.get("TITLE"):e.get("DESKRIPSI"),xtype:e.get("XTYPE"),ui:"panel-cyan",hideHeaders:false,scrollable:true,riwayat:true,showCloseButton:true},function(h,g){var f=g.down(e.get("XTYPE"));f.loadData(c.get("record"),true)},b,true,false)}}});Ext.define("berkas.klaim.obat.dokumenpendukung.Form",{extend:"com.Form",xtype:"berkas-klaim-obat-dokumenpendukung-form",controller:"berkas-klaim-obat-dokumenpendukung-form",model:"berkas.klaim.obat.dokumenpendukung.Model",viewModel:{stores:{berkasKlaimObatDokumenpendukungStore:{type:"berkas-klaim-obat-dokumenpendukung-store"}}},layout:"card",confCetak:false,initComponent:function(){var a=this;a.layout={type:"hbox",align:"stretch"};a.items=[{xtype:"container",layout:{type:"vbox",align:"stretch"},margin:"0 5 0 0",flex:1,defaults:{labelWidth:150,xtype:"textfield",margin:"2 5 2 5"},items:[{fieldLabel:"Deskripsi",name:"DESKRIPSI",emptyText:"Deskripsi"}]},{xtype:"container",layout:{type:"vbox",align:"stretch"},margin:"0 5 0 0",flex:1,defaults:{labelWidth:150,xtype:"textfield",margin:"2 5 2 5"},items:[{fieldLabel:"Jenis Berkas",xtype:"combobox",store:Ext.create("Ext.data.Store",{fields:["id","deskripsi"],data:[{id:"1",deskripsi:"Farmasi"},{id:"2",deskripsi:"Laboratorium Klinik"},{id:"3",deskripsi:"Tindakan Patologi Anatomi"},{id:"4",deskripsi:"Radiologi"}]}),name:"BERKAS",queryMode:"local",displayField:"deskripsi",valueField:"id",emptyText:"[ Jenis Berkas ]"},{fieldLabel:"Dokumen Pendukung",xtype:"filefield",emptyText:"Upload Dokumen",allowBlank:true,idx:0,listeners:{change:"onUpload"},buttonConfig:{text:"",iconCls:"x-fa fa-upload",accept:".pdf",tooltip:"Upload",scale:"small"}}]}];a.buttons=[{text:"Simpan",handler:"OnSimpan"},{text:"Batal",handler:"OnBatal"}];a.callParent(arguments)}});Ext.define("berkas.klaim.obat.dokumenpendukung.FormController",{extend:"Ext.app.ViewController",alias:"controller.berkas-klaim-obat-dokumenpendukung-form",upload:false,dokpendukung:[],onAfterRender:function(){var a=this.getReferences()},onUpload:function(f){var h=this,b=h.getView(),g=f.fileInputEl.dom.files;if(g.length>0){var a=new FileReader(),e=g[0],c=e.type,d=e.size/1024;if(!(c=="application/pdf")){b.notifyMessage("Format file harus pdf");f.reset();return}a.readAsDataURL(e);a.onload=function(i){h.dokpendukung[f.idx]=i;h.upload=true;delete a}}},OnSimpan:function(a){var b=this;view=b.getView();record=view.getRecord();view.setLoading(true);view.save(a,{},function(e,c,d){if(d&&b.upload){if(parseInt(record.get("ID"))){b.sendDokPendukung(a,e,0,"DOKUMEN_PENDUKUNG")}else{b.getViewModel().get("berkasKlaimObatDokumenpendukungStore").removeAll();b.getViewModel().get("berkasKlaimObatDokumenpendukungStore").queryParams={BERKAS:e.get("BERKAS"),TANGGAL:e.get("TANGGAL")};b.getViewModel().get("berkasKlaimObatDokumenpendukungStore").load({callback:function(g,f,h){if(h){b.sendDokPendukung(a,g[0],0,"DOKUMEN_PENDUKUNG")}}})}}view.setLoading(false)});view.getForm().reset();view.fireEvent("Simpan")},OnBatal:function(a){var b=this;view=b.getView();view.fireEvent("Simpan")},privates:{sendDokPendukung:function(d,h,a,e){var f=this,g=f.dokpendukung[a],b=f.getView();if(g){var c=Ext.create("document.storage.Model",{NAME:"BERKAS KLAIM OBAT - "+e+" ("+h.get("ID")+")",EXT:"pdf",DOCUMENT_DIRECTORY_ID:27,REFERENCE_ID:h.get("ID")+"-"+e,DATA:Ext.util.Base64.encode(g.target.result)});c.animateTarget=d;c.scope=f;c.showError=true;c.save({callback:function(k,i,j){if(j){h.set(e,k.get("ID"));h.save();b.notifyMessage("Simpan dokumen pendukung berhasil")}delete f.dokpendukung[a];f.upload=false}})}}}});Ext.define("berkas.klaim.obat.dokumenpendukung.List",{extend:"com.Grid",alias:"widget.berkas-klaim-obat-dokumenpendukung-list",controller:"berkas-klaim-obat-dokumenpendukung-list",flex:1,viewModel:{stores:{store:{type:"berkas-klaim-obat-dokumenpendukung-store"}}},columns:[{text:"Berkas",dataIndex:"BERKAS",menuDisabled:true,sortable:false,renderer:"onBerkasRender",flex:0.5},{text:"Deskripsi",dataIndex:"DESKRIPSI",menuDisabled:true,sortable:true,flex:1,xtype:"templatecolumn",tpl:"<div>{DESKRIPSI}</div>"},{text:"Dokumen Pendukung",xtype:"widgetcolumn",width:90,widget:{xtype:"button",iconCls:"x-fa fa-eye",handler:"onViewDokPendukung"}},{xtype:"actioncolumn",flex:0.4,text:"Hapus",align:"center",items:[{text:"Hapus",ui:"soft-black",iconCls:"x-fa fa-trash",handler:"onClickHapus"}]}],dockedItems:[{xtype:"pagingtoolbar",dock:"bottom",displayInfo:true}]});Ext.define("berkas.klaim.obat.dokumenpendukung.ListController",{extend:"Ext.app.ViewController",alias:"controller.berkas-klaim-obat-dokumenpendukung-list",onBerkasRender:function(c,a,e){var d=e.get("BERKAS");if(d==1){desk="Farmasi"}else{if(d==2){desk="Laboratorium Klinik"}else{if(d==3){desk="Tindakan Patologi Anatomi"}else{desk="Radiologi"}}}return desk},onClickHapus:function(c,f,b){var d=this,a=d.getView(),e=c.getStore().getAt(f);Ext.Msg.show({title:"Hapus Dokumen Pendukung",message:"Anda yakin ingin hapus data ini?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(g){if(g==="yes"){e.set("STATUS",0);e.showError=true;e.scope=d;e.save({callback:function(i,h,j){if(j){Ext.toast({html:"Data telah terhapus",headerPosition:"left",style:"padding: 7px 0px 0px 4px",border:false,header:{width:13},ui:"danger-blue",align:"t"});a.reload()}}})}}})},onViewDokPendukung:function(b){var c=this,a=c.getView(),e=b.getWidgetRecord();url=webservice.location+"document-storage/document/download?requestAccessNumber=";var d=Ext.create("document.storage.request.access.Model",Ext.clone({ID:e.get("DOKUMEN_PENDUKUNG")}));d.save({callback:function(h,g,j){if(j){var f=Ext.JSON.decode(g.getResponse().responseText);var i=a.openDialog("Dokumen Pendukung",true,"100%","100%",{xtype:"box",autoEl:{tag:"iframe",style:"height:100%; width:100%",src:url+f.requestAccessNumber}},function(k,l){},b);delete d}else{a.notifyMessage("Dokumen Pendukung belum ada.")}}})}});Ext.define("berkas.klaim.obat.dokumenpendukung.Workspace",{extend:"com.Form",xtype:"berkas-klaim-obat-dokumenpendukung-workspace",controller:"berkas-klaim-obat-dokumenpendukung-workspace",layout:"card",initComponent:function(){var a=this;a.layout={type:"vbox",align:"stretch"};a.items=[{xtype:"berkas-klaim-obat-dokumenpendukung-form",reference:"refberkasklaimobatdokumenpendukungform",listeners:{Simpan:"OnSave"}},{xtype:"berkas-klaim-obat-dokumenpendukung-list",reference:"refberkasklaimobatdokumenpendukunglist",flex:1}];a.callParent(arguments)},load:function(){var c=this,b=c.down("berkas-klaim-obat-dokumenpendukung-form"),d=c.down("berkas-klaim-obat-dokumenpendukung-list"),a=d.getViewModel(),e=a.get("store");b.createRecord({TANGGAL:c.getSysdate(),STATUS:1});e.queryParams={STATUS:1};e.load()}});Ext.define("berkas.klaim.obat.dokumenpendukung.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.berkas-klaim-obat-dokumenpendukung-workspace",OnSave:function(){var a=this;a.getView().load()}});Ext.define("berkas.klaim.obat.farmasi.List",{extend:"com.Grid",xtype:"berkas-klaim-obat-farmasi-list",controller:"berkas-klaim-obat-farmasi-list",viewModel:{stores:{kunjunganStore:{type:"kunjungan-store"},berkasKlaimObatFarmasiDetilStore:{type:"berkas-klaim-obat-farmasi-detil-store"}},data:{berkasklaimobatfarmasidetil:undefined,berkasklaimobatfarmasidetilstore:undefined,obatfarmasi:false,hideviewresep:true,store:undefined}},selModel:{selType:"checkboxmodel"},bind:{store:"{store}"},initComponent:function(){var a=this;a.columns=[{xtype:"rownumberer",text:"No",align:"left",width:50,bind:{hidden:"{obatfarmasi}"}},{text:"No.Resep",renderer:"renderRef",sortable:false,flex:1,bind:{hidden:"{obatfarmasi}"}},{text:"Tujuan / Unit",renderer:"renderTujuanUnit",flex:1,sortable:false,bind:{hidden:"{obatfarmasi}"}},{xtype:"datecolumn",text:"Tanggal",renderer:"renderMasuk",sortable:false,flex:1,bind:{hidden:"{obatfarmasi}"}},{xtype:"templatecolumn",flex:1,tpl:new Ext.XTemplate('<div style="font-weight: bold; font-size: 14px; white-space:normal !important; color: #0855b3">{[values.REFERENSI.RUANGAN.DESKRIPSI]}</div>',"<div>Masuk: {[this.tanggalJamFormat(values.MASUK)]} | Keluar: {[this.tanggalJamFormat(values.KELUAR)]}</div>","<div>Pendaftaran: {[values.NOPEN]} - {[this.tanggalJamFormat(values.REFERENSI.PENDAFTARAN.TANGGAL)]}</div>",{tanggalJamFormat:function(c){var b=Ext.isDate(c)?c:Ext.Date.parse(c,"Y-m-d H:i:s");return Ext.Date.format(b,"d-m-Y H:i:s")}}),bind:{hidden:"{!obatfarmasi}"}},{xtype:"widgetcolumn",widget:{xtype:"fieldcontainer",defaultType:"button",items:[{text:"View Resep",ui:"soft-blue",handler:"onViewResep"}]},bind:{hidden:"{hideviewresep}"}}];a.callParent(arguments)},listeners:{select:"onSelectObatFarmasi",deselect:"onDeSelectObatFarmasi"},loadStore:function(c){var e=this,d=e.getViewModel().get("kunjunganStore");if(d){d.removeAll();d.queryParams=c;d.load({callback:function(f,a,b){if(b){e.getViewModel().set("store",d)}}})}},loadBerkasKlaimObat:function(c,e){var f=this,d=f.getViewModel().get("kunjunganStore");head=f.getHeaderContainer();berkasKlaimObatFarmasiDetilStore=f.getViewModel().get("berkasKlaimObatFarmasiDetilStore");if(e){berkasKlaimObatFarmasiDetilStore.removeAll();berkasKlaimObatFarmasiDetilStore.queryParams={OBAT_FARMASI:c.get("ID")};berkasKlaimObatFarmasiDetilStore.load({callback:function(b,a,g){if(g){f.getViewModel().set("berkasklaimobatfarmasidetil",b);f.getViewModel().set("berkasklaimobatfarmasidetilstore",berkasKlaimObatFarmasiDetilStore);d.removeAll();d.queryParams={NOSEP:c.get("NOSEP"),JENIS_KUNJUNGAN:11,BERKAS_KLAIM_OBAT_FARMASI:1};d.load({callback:function(h,i,j){if(j){f.getViewModel().set("store",d);arr=[];Ext.Array.findBy(b,function(l,k){found=d.findRecord("NOMOR",l.data.KUNJUNGAN,0,false,true,true);if(found){if(l.data.STATUS==1){arr.push(found)}}});f.setSelection(arr)}}})}}})}else{berkasKlaimObatFarmasiDetilStore.removeAll();berkasKlaimObatFarmasiDetilStore.queryParams={OBAT_FARMASI:c.get("ID"),STATUS:1};berkasKlaimObatFarmasiDetilStore.load({callback:function(b,a,g){if(g){f.getViewModel().set("store",berkasKlaimObatFarmasiDetilStore)}}})}}});Ext.define("berkas.klaim.obat.farmasi.ListController",{extend:"Ext.app.ViewController",alias:"controller.berkas-klaim-obat-farmasi-list",renderRef:function(m,d,l,a,i,c){var f=l.get("REFERENSI"),n=f?(f.KUNJUNGAN?f.KUNJUNGAN.REF:l.get("REF")):"";return n},renderTujuanUnit:function(m,d,l,a,i,c){var f=l.get("REFERENSI"),n=f?(f.KUNJUNGAN?f.KUNJUNGAN.REFERENSI.RUANGAN.DESKRIPSI:l.get("REFERENSI").RUANGAN.DESKRIPSI):"";return n},renderMasuk:function(m,d,l,a,i,c){var f=l.get("REFERENSI"),n=f?(f.KUNJUNGAN?Ext.Date.parse(f.KUNJUNGAN.MASUK,"Y-m-d H:i:s"):Ext.Date.parse(l.get("MASUK"),"Y-m-d H:i:s")):"";return Ext.Date.format(n,"d-m-Y H:i:s")},onViewResep:function(i){var f=this,g=f.getView(),b=f.getViewModel(),c=i.ownerCt.getWidgetRecord(),e="Word",d="docx",a=true,h="Cetak Copy Resep";Ext.Msg.show({title:h,message:"Tekan tombol Yes/Ya utk cetak langsung<br/>Tekan tombol No/Tidak untuk Preview",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"yes",animateTarget:f,fn:function(j){if(j!="yes"){e="Pdf";d="pdf";a=false}g.cetak({TITLE:"RESEP DOKTER - "+c.get("REFERENSI").KUNJUNGAN.REF,NAME:"layanan.farmasi.CetakCopyResep",FINAL:c.get("REFERENSI").KUNJUNGAN.STATUS==2?1:0,DOCUMENT_STORAGE:{REF_ID:c.get("REFERENSI").KUNJUNGAN.REF,DOCUMENT_DIRECTORY_ID:15},TYPE:e,EXT:d,PARAMETER:{PNOMOR:c.get("REFERENSI").KUNJUNGAN.REF,CETAK_HEADER:1},REQUEST_FOR_PRINT:a,PRINT_NAME:"CetakResep"})}})},onSelectObatFarmasi:function(a,c,b){this.checkedobatfarmasi(c,true)},onDeSelectObatFarmasi:function(a,b){this.checkedobatfarmasi(b,false)},privates:{checkedobatfarmasi:function(d,c){var b=this,a=b.getViewModel().get("store"),e=b.getViewModel().get("berkasKlaimObatFarmasiDetilStore");found=a.findRecord("NOMOR",d.get("NOMOR"),0,false,true,true);Ext.Array.each(b.getViewModel().get("berkasklaimobatfarmasidetil"),function(g,f){foundobatfarmasi=e.findRecord("KUNJUNGAN",d.get("NOMOR"),0,false,true,true);if(foundobatfarmasi){if(found.get("NOMOR")&&found.get("NOMOR")!=0){foundobatfarmasi.set("STATUS",c?1:0)}else{if(!c){a.remove(found)}}}})}}});Ext.define("berkas.klaim.obat.farmasi.Workspace",{extend:"com.Form",alias:"widget.berkas-klaim-obat-farmasi-workspace",controller:"berkas-klaim-obat-farmasi-workspace",viewModel:{stores:{berkasKlaimObatFarmasiStore:{type:"berkas-klaim-obat-farmasi-store"}},data:{hideSimpan:true,penjamin:undefined,statusobatfarmasi:false,dataobatfarmasi:undefined}},layout:"border",initComponent:function(){var b=this;b.items=[{region:"center",title:"Daftar Order",xtype:"berkas-klaim-obat-farmasi-list",reference:"riwayatorderreseplist",listeners:{select:"onOrderSelected"}},{region:"east",xtype:"riwayat-resep-listdetil",title:"Detil Order",reference:"riwayatorderresepdetil",flex:1,collapsible:true,split:true}];b.dockedItems=[{xtype:"toolbar",dock:"bottom",items:["->",{xtype:"button",ui:"soft-blue",iconCls:"x-fa fa-save",text:"Simpan",reference:"btnOnSimpan",bind:{hidden:"{hideSimpan}"},handler:"btnSimpan"}]}];b.callParent(arguments)},loadData:function(d){var c=this,b=c.getViewModel(),a=c.down("[reference=riwayatorderreseplist]");xpriv=webservice.app.xpriv;allowIcd=xpriv("2401010401",true);if(allowIcd){b.set("hideSimpan",false)}a.setGridConfig({paging:true});a.setHideHeaders(true);a.getViewModel().set("obatfarmasi",true);b.set("penjamin",d);if(d){b.get("berkasKlaimObatFarmasiStore").removeAll();b.get("berkasKlaimObatFarmasiStore").queryParams={PENDAFTARAN:d.get("NOPEN")};b.get("berkasKlaimObatFarmasiStore").load({callback:function(f,e,g){if(g){b.set("statusobatfarmasi",true);b.set("dataobatfarmasi",f[0]);a.loadBerkasKlaimObat(f[0],true)}else{b.set("statusobatfarmasi",false);a.loadStore({NOSEP:d.get("NOMOR"),JENIS_KUNJUNGAN:11,BERKAS_KLAIM_OBAT_FARMASI:1})}}})}}});Ext.define("berkas.klaim.obat.farmasi.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.berkas-klaim-obat-farmasi-workspace",onOrderSelected:function(i,f){var h=this,a=h.getReferences(),g=f.get("NOMOR");a.riwayatorderresepdetil.loadStore({KUNJUNGAN:g})},btnSimpan:function(b){var e=this,d=e.getReferences(),c=e.getViewModel(),a=e.getView();arr=[];grid=d.riwayatorderreseplist.getSelection();Ext.Array.each(grid,function(g,f){arr.push({KUNJUNGAN:g.get("NOMOR")})});if(c.get("dataobatfarmasi")){e.simpanData(false,grid,b)}else{if(arr.length==0){a.notifyMessage("Silahkan memilih/centang data terlebih dahulu.")}else{e.simpanData(arr,false,b)}}},simpanData:function(a,d,c){var g=this,f=g.getReferences(),e=g.getViewModel(),b=g.getView();counter=0;Ext.Msg.show({title:"Konfirmasi",message:"Selesai menginput data?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:c,fn:function(h){if(h=="yes"){if(e.get("statusobatfarmasi")){gridstore=f.riwayatorderreseplist.getViewModel().get("berkasklaimobatfarmasidetilstore");modifieds=gridstore.getModifiedRecords();if(modifieds.length!=0){Ext.Array.each(modifieds,function(i){i.set("OBAT_FARMASI",e.get("dataobatfarmasi").get("ID"))});gridstore.sync({callback:function(i){if(i){if(counter===(modifieds.length-1)){g.getView().notifyMessage("Data berhasil diupdate.")}b.loadData(e.get("penjamin"))}counter++}})}Ext.Array.each(d,function(j,i){found=gridstore.findRecord("KUNJUNGAN",j.data.NOMOR,0,false,true,true);if(!found){rod=Ext.create("berkas.klaim.obat.farmasi.detil.Model",{});rod.set("OBAT_FARMASI",e.get("dataobatfarmasi").get("ID"));rod.set("KUNJUNGAN",j.data.NOMOR);rod.save({callback:function(m,k,l){if(l){g.getView().notifyMessage("Data berhasil diupdate.");b.loadData(e.get("penjamin"))}}})}})}else{ro=Ext.create("berkas.klaim.obat.farmasi.Model",{});ro.set("PENDAFTARAN",e.get("penjamin").get("NOPEN"));ro.set("NOSEP",e.get("penjamin").get("NOMOR"));ro.set("OBAT_FARMASI",a);ro.save({callback:function(k,i,j){if(j){g.getView().notifyMessage("Data berhasil disimpan.");b.loadData(e.get("penjamin"))}}})}}}})}});Ext.define("berkas.klaim.obat.labklinik.ListHasilLab",{extend:"com.Grid",alias:"widget.berkas-klaim-obat-labklinik-listhasillab",controller:"berkas-klaim-obat-labklinik-listhasillab",viewModel:{data:{tindakan:undefined,store:undefined,berkasklaimobatlabklinikdetil:undefined,berkasklaimobatlabklinikdetilstore:undefined},stores:{hasillabstore:{type:"hasillab-store"},parameterstore:{type:"parametertindakanlab-store"},berkasKlaimObatLabklinikDetilStore:{type:"berkas-klaim-obat-labklinik-detil-store"}}},bind:{title:"Input Hasil Laboratorium - {tindakan.TINDAKAN_DESKRIPSI}",store:"{store}"},selModel:{selType:"checkboxmodel"},border:false,initComponent:function(){var a=this;a.callParent()},columns:[{xtype:"rownumberer",text:"No",align:"left",width:"5%"},{xtype:"templatecolumn",text:"Parameter",tpl:'{[this.getReferensi(values, "PARAMETER_TINDAKAN", "PARAMETER")]}',flex:2},{text:"Nilai Normal",flex:2,dataIndex:"NILAI_NORMAL"},{text:"Satuan",dataIndex:"SATUAN",flex:2},{text:"Hasil",dataIndex:"HASIL",flex:2},{text:"Keterangan",dataIndex:"KETERANGAN",flex:2}],listeners:{select:"onSelectHasilLab",deselect:"onDeselectHasilLab"},loadParameters:function(b,a){var e=this,d=e.getViewModel(),c=d.get("hasillabstore"),f=d.get("parameterstore");d.set("tindakan",b);if(a){d.get("berkasKlaimObatLabklinikDetilStore").removeAll();d.get("berkasKlaimObatLabklinikDetilStore").queryParams={LAB_KLINIK:a.get("ID")};d.get("berkasKlaimObatLabklinikDetilStore").load({callback:function(g,h,i){if(i){d.set("berkasklaimobatlabklinikdetil",g);d.set("berkasklaimobatlabklinikdetilstore",d.get("berkasKlaimObatLabklinikDetilStore"));f.queryParams={TINDAKAN:b.get("TINDAKAN"),STATUS:1};f.load({callback:function(k,j,l){if(l){c.queryParams={TINDAKAN_MEDIS:b.get("ID")};c.load({callback:function(m,n,o){if(o){d.set("store",c);arr=[];Ext.Array.findBy(g,function(q,p){found=c.findRecord("ID",q.data.HASIL_LAB,0,false,true,true);if(found){if(q.data.STATUS==1){arr.push(found)}}});e.setSelection(arr)}}})}}})}}})}else{f.queryParams={TINDAKAN:b.get("TINDAKAN"),STATUS:1};f.load({callback:function(h,g,i){if(i){c.queryParams={TINDAKAN_MEDIS:b.get("ID")};c.load({callback:function(l,j,k){if(k){d.set("store",c)}}})}}})}}});Ext.define("berkas.klaim.obat.labklinik.ListHasilLabController",{extend:"Ext.app.ViewController",alias:"controller.berkas-klaim-obat-labklinik-listhasillab",onSelectHasilLab:function(a,c,b){this.checkedhasillab(c,true)},onDeselectHasilLab:function(a,b){this.checkedhasillab(b,false)},privates:{checkedhasillab:function(e,d){var c=this,b=c.getViewModel().get("store"),a=c.getViewModel().get("berkasKlaimObatLabklinikDetilStore");found=b.findRecord("ID",e.get("ID"),0,false,true,true);Ext.Array.each(c.getViewModel().get("berkasklaimobatlabklinikdetil"),function(g,f){foundobatlk=a.findRecord("HASIL_LAB",e.get("ID"),0,false,true,true);if(foundobatlk){if(found.get("ID")&&found.get("ID")!=0){foundobatlk.set("STATUS",d?1:0)}else{if(!d){b.remove(found)}}}})}}});Ext.define("berkas.klaim.obat.labklinik.ListTindakan",{extend:"com.Grid",alias:"widget.berkas-klaim-obat-labklinik-listtindakan",controller:"berkas-klaim-obat-labklinik-listtindakan",viewModel:{stores:{tindakanmedisstore:{type:"tindakan-medis-store",pageSize:100000},berkasKlaimObatLabklinikDetilStore:{type:"berkas-klaim-obat-labklinik-detil-store"}},data:{berkaslabklinik:false,hideviewlabklinik:true,store:undefined,recs:undefined,lk:undefined,akses:undefined}},bind:{store:"{store}"},title:"Tindakan",hideHeaders:true,initComponent:function(){var b=this;b.columns=[{xtype:"templatecolumn",flex:1,tpl:new Ext.XTemplate('<div style="font-size: 14px; font-weight: bold; white-space:normal !important;">{TINDAKAN_DESKRIPSI}</div><div style="font-size: 12px; white-space:normal !important;">{[this.tanggalFormat(values.TANGGAL)]} | {[this.getNamaLengkap(this.getReferensi(values, "PENGGUNA"))]}</div><div style="font-size: 12px">Jenis: {[this.getReferensi(values, "JENIS_TINDAKAN", "DESKRIPSI")]}</div>'),bind:{hidden:"{berkaslabklinik}"}},{xtype:"rownumberer",text:"No",align:"left",width:50,bind:{hidden:"{hideviewlabklinik}"}},{xtype:"templatecolumn",text:"Pemeriksaan",flex:1,sortable:false,tpl:new Ext.XTemplate('<div style="font-size: 14px; font-weight: bold; white-space:normal !important;">{REFERENSI.HASIL_LAB.REFERENSI.TINDAKAN_MEDIS.TINDAKAN_DESKRIPSI}</div><div style="font-size: 12px; white-space:normal !important;">{[this.tanggalFormat(values.REFERENSI.HASIL_LAB.REFERENSI.TINDAKAN_MEDIS.TANGGAL)]}</div>'),bind:{hidden:"{hideviewlabklinik}"}},{xtype:"templatecolumn",text:"Pemeriksa",flex:1,sortable:false,tpl:new Ext.XTemplate('<div style="font-size: 12px">{REFERENSI.HASIL_LAB.REFERENSI.TINDAKAN_MEDIS.REFERENSI.JENIS_TINDAKAN.DESKRIPSI}</div>'),bind:{hidden:"{hideviewlabklinik}"}},{xtype:"widgetcolumn",widget:{xtype:"fieldcontainer",defaultType:"button",items:[{text:"View",ui:"soft-blue",handler:"onViewLabKlinik"}]},bind:{hidden:"{hideviewlabklinik}"}}];b.dockedItems=[{xtype:"pagingtoolbar",bind:{store:"{store}"},dock:"bottom",displayInfo:true},{xtype:"search-field",dock:"top",cls:"x-text-border",autoFocus:true,emptyText:"Cari Tindakan",flex:1,listeners:{search:"onsearch",clear:"onClear"}}];b.callParent(arguments)},listeners:{select:"onTindakanSelected"},loadDataTindakanMedisLK:function(e,d,c,f){var b=this,a=b.getViewModel();a.set("recs",e);a.set("lk",d);a.set("akses",c);if(c){a.get("berkasKlaimObatLabklinikDetilStore").removeAll();a.get("berkasKlaimObatLabklinikDetilStore").queryParams={LAB_KLINIK:d.get("ID"),GROUP_TINDAKAN_MEDIS:1,STATUS:1};a.get("berkasKlaimObatLabklinikDetilStore").load({callback:function(g,h,i){if(i){a.set("store",a.get("berkasKlaimObatLabklinikDetilStore"))}}})}else{if(f){tgl=Ext.isDate(e.get("REFERENSI").PENDAFTARAN.TANGGAL)?e.get("REFERENSI").PENDAFTARAN.TANGGAL:Ext.Date.parse(e.get("REFERENSI").PENDAFTARAN.TANGGAL,"Y-m-d H:i:s");a.get("tindakanmedisstore").removeAll();a.get("tindakanmedisstore").queryParams={NORM:e.get("REFERENSI").PENDAFTARAN.NORM,TANGGAL:Ext.Date.format(tgl,"Y-m-d"),BERKAS_KLAIM_OBAT_LAB_KLINIK:1,TINDAKAN_DESKRIPSI:f};a.get("tindakanmedisstore").load({callback:function(g,h,i){if(i){a.set("store",a.get("tindakanmedisstore"))}}})}else{tgl=Ext.isDate(e.get("REFERENSI").PENDAFTARAN.TANGGAL)?e.get("REFERENSI").PENDAFTARAN.TANGGAL:Ext.Date.parse(e.get("REFERENSI").PENDAFTARAN.TANGGAL,"Y-m-d H:i:s");a.get("tindakanmedisstore").removeAll();a.get("tindakanmedisstore").queryParams={NORM:e.get("REFERENSI").PENDAFTARAN.NORM,TANGGAL:Ext.Date.format(tgl,"Y-m-d"),BERKAS_KLAIM_OBAT_LAB_KLINIK:1};a.get("tindakanmedisstore").load({callback:function(g,h,i){if(i){a.set("store",a.get("tindakanmedisstore"))}}})}}}});Ext.define("berkas.klaim.obat.labklinik.ListTindakanController",{extend:"Ext.app.ViewController",alias:"controller.berkas-klaim-obat-labklinik-listtindakan",onsearch:function(d,a){var b=this;b.getView().loadDataTindakanMedisLK(b.getViewModel().get("recs"),b.getViewModel().get("lk"),b.getViewModel().get("akses"),a)},onClear:function(){var e=this,f=e.getViewModel(),a=f.get("store");a.removeAll();delete a.queryParams.TINDAKAN_DESKRIPSI;e.getView().loadDataTindakanMedisLK(e.getViewModel().get("recs"),e.getViewModel().get("lk"),e.getViewModel().get("akses"),false)},onTindakanSelected:function(d,c){this.getView().fireEvent("tindakanselected",d,c)},onViewLabKlinik:function(b){var d=this,a=d.getView(),c=d.getViewModel(),e=b.ownerCt.getWidgetRecord();a.openDialog("",false,"100%","100%",{title:"Hasil Laboratorium",xtype:"berkas-klaim-obat-labklinik-workspace",ui:"panel-cyan",scrollable:true,showCloseButton:true},function(h,g){var f=g.down("berkas-klaim-obat-labklinik-workspace");f.loadData(e,false)},b,true,false)}});Ext.define("berkas.klaim.obat.labklinik.Workspace",{extend:"com.Form",alias:"widget.berkas-klaim-obat-labklinik-workspace",controller:"berkas-klaim-obat-labklinik-workspace",viewModel:{stores:{berkasKlaimObatLabklinikStore:{type:"berkas-klaim-obat-labklinik-store"}},data:{hideSimpan:true,penjamin:undefined,statuslabklinik:false,datalabklinik:undefined,tindakanmedis:undefined}},layout:"border",bodyPadding:0,initComponent:function(){var b=this;b.items=[{region:"west",xtype:"berkas-klaim-obat-labklinik-listtindakan",flex:0.5,margin:"0 2 0 0",split:true,collapsible:true,reference:"reftindakanmedislist",listeners:{tindakanselected:"onTindakanLKSelected"},hidden:true},{region:"center",xtype:"berkas-klaim-obat-labklinik-listhasillab",border:false,title:"Hasil Laboratorium",reference:"listlab"},{region:"east",title:"Catatan",flex:0.5,split:true,collapsed:false,collapsible:true,xtype:"form-hasil-lab-catatan",border:false,reference:"formsaran"},{region:"east",width:350,split:{size:3},collapsed:true,collapsible:true,xtype:"layanan-laboratorium-perujuk-form",reference:"formperujuk",border:false}];b.dockedItems=[{xtype:"toolbar",dock:"bottom",items:["->",{xtype:"button",ui:"soft-blue",iconCls:"x-fa fa-save",text:"Simpan",reference:"btnOnSimpan",bind:{hidden:"{hideSimpan}"},handler:"btnSimpan"}]}];b.callParent(arguments)},loadData:function(c,f){var h=this,b=h.getViewModel(),i=h.down("[reference=reftindakanmedislist]"),a=h.down("[reference=listlab]"),d=h.down("[reference=formsaran]"),g=h.down("[reference=formperujuk]"),e=webservice.app.xpriv;allowIcd=e("2401010401",true);if(allowIcd){b.set("hideSimpan",false)}if(f){i.setHidden(false);i.loadDataTindakanMedisLK(c,false,false,false);a.getViewModel().get("store").removeAll()}else{if(data.model){data.model.TindakanMedis.load(c.get("REFERENSI").HASIL_LAB.REFERENSI.TINDAKAN_MEDIS.ID,{callback:function(j,k,l){berkas.klaim.obat.labklinik.Model.load(c.get("LAB_KLINIK"),{callback:function(o,m,n){if(n){a.loadParameters(j,o)}}})}});data.model.CatatanHasilLab.load(c.get("REFERENSI").HASIL_LAB.REFERENSI.TINDAKAN_MEDIS.KUNJUNGAN,{callback:function(l,j,k){if(k){d.loadRecord(l)}}})}g.loadById({NOMOR:c.get("REFERENSI").HASIL_LAB.REFERENSI.TINDAKAN_MEDIS.REFERENSI.KUNJUNGAN.REF})}d.setFormConfig({viewOnly:true,simpan:false});b.set("penjamin",c);if(c){b.get("berkasKlaimObatLabklinikStore").removeAll();b.get("berkasKlaimObatLabklinikStore").queryParams={NOSEP:c.get("NOMOR")};b.get("berkasKlaimObatLabklinikStore").load({callback:function(l,j,k){if(k){b.set("statuslabklinik",true);b.set("datalabklinik",l[0])}else{b.set("statuslabklinik",false)}}})}}});Ext.define("berkas.klaim.obat.labklinik.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.berkas-klaim-obat-labklinik-workspace",onTindakanLKSelected:function(c,e){var d=this,a=this.getView(),b=this.getReferences();if(e){d.getViewModel().set("tindakanmedis",e);b.listlab.loadParameters(e,this.getViewModel().get("datalabklinik"));if(data.model){data.model.CatatanHasilLab.load(e.get("KUNJUNGAN"),{callback:function(h,f,g){if(g){b.formsaran.loadRecord(h)}}})}b.formperujuk.loadById({NOMOR:a.getReferensi(e.getData(),"KUNJUNGAN","REF")})}},btnSimpan:function(b){var e=this,d=e.getReferences(),c=e.getViewModel(),a=e.getView();arr=[];grid=d.listlab.getSelection();Ext.Array.each(grid,function(g,f){arr.push({HASIL_LAB:g.get("ID"),TINDAKAN_MEDIS:e.getViewModel().get("tindakanmedis").get("ID")})});if(c.get("datalabklinik")){e.simpanData(false,grid,b)}else{if(arr.length==0){a.notifyMessage("Silahkan memilih/centang data terlebih dahulu.")}else{e.simpanData(arr,false,b)}}},simpanData:function(a,d,c){var g=this,f=g.getReferences(),e=g.getViewModel(),b=g.getView();counter=0;Ext.Msg.show({title:"Konfirmasi",message:"Selesai menginput data?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:c,fn:function(h){if(h=="yes"){if(e.get("statuslabklinik")){gridstore=f.listlab.getViewModel().get("berkasklaimobatlabklinikdetilstore");modifieds=gridstore.getModifiedRecords();if(modifieds.length!=0){Ext.Array.each(modifieds,function(i){i.set("LAB_KLINIK",e.get("datalabklinik").get("ID"))});gridstore.sync({callback:function(i){if(i){if(counter===(modifieds.length-1)){g.getView().notifyMessage("Data berhasil diupdate.")}b.loadData(e.get("penjamin"),true)}counter++}})}Ext.Array.each(d,function(j,i){found=gridstore.findRecord("HASIL_LAB",j.data.ID,0,false,true,true);if(!found){rod=Ext.create("berkas.klaim.obat.labklinik.detil.Model",{});rod.set("LAB_KLINIK",e.get("datalabklinik").get("ID"));rod.set("HASIL_LAB",j.data.ID);rod.set("TINDAKAN_MEDIS",g.getViewModel().get("tindakanmedis").get("ID"));rod.save({callback:function(m,k,l){if(l){g.getView().notifyMessage("Data berhasil diupdate.");b.loadData(e.get("penjamin"),true)}}})}})}else{ro=Ext.create("berkas.klaim.obat.labklinik.Model",{});ro.set("NORM",e.get("penjamin").get("REFERENSI").PENDAFTARAN.NORM);ro.set("NOSEP",e.get("penjamin").get("NOMOR"));ro.set("LAB_KLINIK",a);ro.save({callback:function(k,i,j){if(j){g.getView().notifyMessage("Data berhasil disimpan.");b.loadData(e.get("penjamin"),true)}}})}}}})}});Ext.define("berkas.klaim.obat.radiologi.List",{extend:"com.Grid",alias:"widget.berkas-klaim-obat-radiologi-list",controller:"berkas-klaim-obat-radiologi-list",viewModel:{stores:{hasilradstore:{type:"hasilrad-store"},berkasKlaimObatRadiologiDetilStore:{type:"berkas-klaim-obat-radiologi-detil-store"}},data:{store:undefined,berkasklaimobatradiologidetil:undefined,berkasklaimobatradiologidetilstore:undefined,berkasradiologi:false,hideviewradiologi:true,recs:undefined,bkor:undefined,user:undefined}},title:"Daftar Hasil Pemeriksaan Radiologi",hideHeaders:true,bind:{store:"{store}"},selModel:{selType:"checkboxmodel"},initComponent:function(){var a=this;a.columns=[{xtype:"templatecolumn",flex:1,tpl:new Ext.XTemplate('<div style="font-size: 14px; font-weight: bold; white-space:normal !important;">{[this.getReferensi(values, "TINDAKAN_MEDIS", "TINDAKAN_DESKRIPSI")]}</div><div style="font-size: 12px; white-space:normal !important;">{[this.tanggalFormat(values.TANGGAL)]}</div><div style="font-size: 12px">Jenis: {[this.getReferensi(this.getReferensi(values, "TINDAKAN_MEDIS"), "JENIS_TINDAKAN", "DESKRIPSI")]}</div>'),bind:{hidden:"{!berkasradiologi}"}},{xtype:"rownumberer",text:"No",align:"left",width:50,bind:{hidden:"{hideviewradiologi}"}},{xtype:"templatecolumn",text:"Pemeriksaan",flex:1,sortable:false,tpl:new Ext.XTemplate('<div style="font-size: 14px; font-weight: bold; white-space:normal !important;">{[values.REFERENSI.HASIL_RAD.REFERENSI.TINDAKAN_MEDIS.TINDAKAN_DESKRIPSI]}</div><div style="font-size: 12px; white-space:normal !important;">{[this.tanggalFormat(values.REFERENSI.HASIL_RAD.TANGGAL)]}</div>'),bind:{hidden:"{hideviewradiologi}"}},{xtype:"templatecolumn",text:"Pemeriksa",flex:1,sortable:false,tpl:new Ext.XTemplate('<div style="font-size: 12px">{[values.REFERENSI.HASIL_RAD.REFERENSI.TINDAKAN_MEDIS.REFERENSI.JENIS_TINDAKAN.DESKRIPSI]}</div>'),bind:{hidden:"{hideviewradiologi}"}},{xtype:"widgetcolumn",widget:{xtype:"fieldcontainer",defaultType:"button",items:[{text:"View",ui:"soft-blue",handler:"onViewRadiologi"}]},bind:{hidden:"{hideviewradiologi}"}}];a.dockedItems=[{xtype:"pagingtoolbar",bind:{store:"{store}"},dock:"bottom",displayInfo:true},{xtype:"search-field",dock:"top",cls:"x-text-border",autoFocus:true,emptyText:"Cari Tindakan",flex:1,listeners:{search:"onsearch",clear:"onClear"}}];a.callParent(arguments)},listeners:{select:"onSelectTindakan",deselect:"onDeselectTindakan"},load:function(c){var e=this,d=this.getViewModel().get("hasilradstore");if(d){d.removeAll();d.queryParams=c;d.load({callback:function(f,a,b){if(b){e.getViewModel().set("store",d)}}})}},loadDataBerkasKlaimObatRadiologi:function(f,c,d,g){var e=this,b=e.getViewModel().get("hasilradstore");head=e.getHeaderContainer();berkasKlaimObatRadiologiDetilStore=e.getViewModel().get("berkasKlaimObatRadiologiDetilStore");tgl=Ext.isDate(f.get("REFERENSI").PENDAFTARAN.TANGGAL)?f.get("REFERENSI").PENDAFTARAN.TANGGAL:Ext.Date.parse(f.get("REFERENSI").PENDAFTARAN.TANGGAL,"Y-m-d H:i:s");e.getViewModel().set("recs",f);e.getViewModel().set("bkor",c);e.getViewModel().set("user",d);if(d){if(c){berkasKlaimObatRadiologiDetilStore.removeAll();berkasKlaimObatRadiologiDetilStore.queryParams={RADIOLOGI:c.get("ID")};berkasKlaimObatRadiologiDetilStore.load({callback:function(h,a,i){if(i){e.getViewModel().set("berkasklaimobatradiologidetil",h);e.getViewModel().set("berkasklaimobatradiologidetilstore",berkasKlaimObatRadiologiDetilStore);if(g){b.removeAll();b.queryParams={NORM:f.get("REFERENSI").PENDAFTARAN.NORM,TANGGAL:Ext.Date.format(tgl,"Y-m-d"),BERKAS_KLAIM_OBAT_RADIOLOGI:1,TINDAKAN_DESKRIPSI:g};b.load({callback:function(j,k,l){if(l){e.getViewModel().set("store",b);arr=[];Ext.Array.findBy(h,function(n,m){found=b.findRecord("ID",n.data.HASIL_RAD,0,false,true,true);if(found){if(n.data.STATUS==1){arr.push(found)}}});e.setSelection(arr)}}})}else{b.removeAll();b.queryParams={NORM:f.get("REFERENSI").PENDAFTARAN.NORM,TANGGAL:Ext.Date.format(tgl,"Y-m-d"),BERKAS_KLAIM_OBAT_RADIOLOGI:1};b.load({callback:function(j,k,l){if(l){e.getViewModel().set("store",b);arr=[];Ext.Array.findBy(h,function(n,m){found=b.findRecord("ID",n.data.HASIL_RAD,0,false,true,true);if(found){if(n.data.STATUS==1){arr.push(found)}}});e.setSelection(arr)}}})}}}})}else{if(g){b.removeAll();b.queryParams={NORM:f.get("REFERENSI").PENDAFTARAN.NORM,TANGGAL:Ext.Date.format(tgl,"Y-m-d"),BERKAS_KLAIM_OBAT_RADIOLOGI:1,TINDAKAN_DESKRIPSI:g};b.load({callback:function(a,h,i){if(i){e.getViewModel().set("store",b)}}})}else{b.removeAll();b.queryParams={NORM:f.get("REFERENSI").PENDAFTARAN.NORM,TANGGAL:Ext.Date.format(tgl,"Y-m-d"),BERKAS_KLAIM_OBAT_RADIOLOGI:1};b.load({callback:function(a,h,i){if(i){e.getViewModel().set("store",b)}}})}}}else{berkasKlaimObatRadiologiDetilStore.removeAll();berkasKlaimObatRadiologiDetilStore.queryParams={RADIOLOGI:c.get("ID"),STATUS:1};berkasKlaimObatRadiologiDetilStore.load({callback:function(h,a,i){if(i){e.getViewModel().set("store",berkasKlaimObatRadiologiDetilStore)}}})}}});Ext.define("berkas.klaim.obat.radiologi.ListController",{extend:"Ext.app.ViewController",alias:"controller.berkas-klaim-obat-radiologi-list",onsearch:function(d,a){var b=this;b.getView().loadDataBerkasKlaimObatRadiologi(b.getViewModel().get("recs"),b.getViewModel().get("bkor"),b.getViewModel().get("user"),a)},onClear:function(){var e=this,f=e.getViewModel(),a=f.get("store");a.removeAll();delete a.queryParams.TINDAKAN_DESKRIPSI;e.getView().loadDataBerkasKlaimObatRadiologi(e.getViewModel().get("recs"),e.getViewModel().get("bkor"),e.getViewModel().get("user"),false)},onSelectTindakan:function(a,c,b){this.checkedobatradiologi(c,true)},onDeselectTindakan:function(a,b){this.checkedobatradiologi(b,false)},privates:{checkedobatradiologi:function(e,d){var c=this,b=c.getViewModel().get("store"),a=c.getViewModel().get("berkasKlaimObatRadiologiDetilStore");found=b.findRecord("ID",e.get("ID"),0,false,true,true);Ext.Array.each(c.getViewModel().get("berkasklaimobatradiologidetil"),function(g,f){foundobatradiologi=a.findRecord("HASIL_RAD",e.get("ID"),0,false,true,true);if(foundobatradiologi){if(found.get("ID")&&found.get("ID")!=0){foundobatradiologi.set("STATUS",d?1:0)}else{if(!d){b.remove(found)}}}})}},onViewRadiologi:function(b){var d=this,a=d.getView(),c=d.getViewModel(),e=b.ownerCt.getWidgetRecord();a.openDialog("",false,"100%","100%",{title:"Tindakan Radiologi",xtype:"berkas-klaim-obat-radiologi-workspacerad",ui:"panel-cyan",scrollable:true,showCloseButton:true},function(h,g){var f=g.down("berkas-klaim-obat-radiologi-workspacerad");f.setFormConfig({viewOnly:true,simpan:false,cetak:false,riwayat:true});c.get("hasilradstore").removeAll();c.get("hasilradstore").queryParams={HASIL_RAD:e.get("HASIL_RAD")};c.get("hasilradstore").load({callback:function(j,i,k){if(k){f.load(j[0])}}})},b,true,false)}});Ext.define("berkas.klaim.obat.radiologi.Workspace",{extend:"com.Form",alias:"widget.berkas-klaim-obat-radiologi-workspace",controller:"berkas-klaim-obat-radiologi-workspace",viewModel:{stores:{berkasKlaimObatRadiologiStore:{type:"berkas-klaim-obat-radiologi-store"}},data:{hideSimpan:true,penjamin:undefined,statusradiologi:false,dataradiologi:undefined}},layout:"border",bodyPadding:0,initComponent:function(){var b=this;b.items=[{region:"west",xtype:"berkas-klaim-obat-radiologi-list",flex:0.5,margin:"0 2 0 0",split:true,collapsible:true,reference:"hasillist",listeners:{select:"onTindakanSelected"}},{xtype:"berkas-klaim-obat-radiologi-workspacerad",region:"center",reference:"hasilrad",bodyPadding:0,width:2}];b.dockedItems=[{xtype:"toolbar",dock:"bottom",items:["->",{xtype:"button",ui:"soft-blue",iconCls:"x-fa fa-save",text:"Simpan",reference:"btnOnSimpan",bind:{hidden:"{hideSimpan}"},handler:"btnSimpan"}]}];b.callParent(arguments)},loadData:function(e){var d=this,c=d.getViewModel(),b=d.down("[reference=hasillist]"),a=d.down("[reference=hasilrad]");xpriv=webservice.app.xpriv;allowIcd=xpriv("2401010401",true);if(allowIcd){c.set("hideSimpan",false)}b.setListConfig({paging:true});a.setFormConfig({riwayat:true});a.load(null);b.getViewModel().set("berkasradiologi",true);c.set("penjamin",e);if(e){c.get("berkasKlaimObatRadiologiStore").removeAll();c.get("berkasKlaimObatRadiologiStore").queryParams={NOSEP:e.get("NOMOR")};c.get("berkasKlaimObatRadiologiStore").load({callback:function(f,g,h){if(h){c.set("statusradiologi",true);c.set("dataradiologi",f[0]);b.loadDataBerkasKlaimObatRadiologi(e,f[0],true,false)}else{c.set("statusradiologi",false);b.loadDataBerkasKlaimObatRadiologi(e,false,true,false)}}})}}});Ext.define("berkas.klaim.obat.radiologi.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.berkas-klaim-obat-radiologi-workspace",onTindakanSelected:function(b,d){var c=this,a=c.getReferences();a.hasilrad.load(d)},btnSimpan:function(b){var e=this,d=e.getReferences(),c=e.getViewModel(),a=e.getView();arr=[];grid=d.hasillist.getSelection();Ext.Array.each(grid,function(g,f){arr.push({HASIL_RAD:g.get("ID")})});if(c.get("dataradiologi")){e.simpanData(false,grid,b)}else{if(arr.length==0){a.notifyMessage("Silahkan memilih/centang data terlebih dahulu.")}else{e.simpanData(arr,false,b)}}},simpanData:function(a,d,c){var g=this,f=g.getReferences(),e=g.getViewModel(),b=g.getView();counter=0;Ext.Msg.show({title:"Konfirmasi",message:"Selesai menginput data?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:c,fn:function(h){if(h=="yes"){if(e.get("statusradiologi")){gridstore=f.hasillist.getViewModel().get("berkasklaimobatradiologidetilstore");modifieds=gridstore.getModifiedRecords();if(modifieds.length!=0){Ext.Array.each(modifieds,function(i){i.set("RADIOLOGI",e.get("dataradiologi").get("ID"))});gridstore.sync({callback:function(i){if(i){if(counter===(modifieds.length-1)){g.getView().notifyMessage("Data berhasil diupdate.")}b.loadData(e.get("penjamin"))}counter++}})}Ext.Array.each(d,function(j,i){found=gridstore.findRecord("HASIL_RAD",j.data.ID,0,false,true,true);if(!found){rod=Ext.create("berkas.klaim.obat.radiologi.detil.Model",{});rod.set("RADIOLOGI",e.get("dataradiologi").get("ID"));rod.set("HASIL_RAD",j.data.ID);rod.save({callback:function(m,k,l){if(l){g.getView().notifyMessage("Data berhasil diupdate.");b.loadData(e.get("penjamin"))}}})}})}else{ro=Ext.create("berkas.klaim.obat.radiologi.Model",{});ro.set("NORM",e.get("penjamin").get("REFERENSI").PENDAFTARAN.NORM);ro.set("NOSEP",e.get("penjamin").get("NOMOR"));ro.set("RADIOLOGI",a);ro.save({callback:function(k,i,j){if(j){g.getView().notifyMessage("Data berhasil disimpan.");b.loadData(e.get("penjamin"))}}})}}}})}});Ext.define("berkas.klaim.obat.radiologi.WorkspaceRad",{extend:"com.Form",alias:"widget.berkas-klaim-obat-radiologi-workspacerad",controller:"berkas-klaim-obat-radiologi-workspacerad",viewModel:{data:{kunjungan:undefined,formConfig:{riwayat:false}},stores:{store:{type:"hasilrad-store"}}},layout:"border",initComponent:function(){var a=this;a.items=[{region:"west",title:"Tindakan",hideAction:true,flex:0.3,xtype:"tindakan-medis-list",reference:"listindakanmedist",split:true,collapsed:false,collapsible:true,bind:{hidden:"{formConfig.riwayat}"},header:{items:[{xtype:"button",ui:"soft-cyan",iconCls:"x-fa fa-print",tooltip:"Cetak Job List",menu:{plain:true,width:200,items:[{text:"Format I",action:1,listeners:{scope:a.getController(),click:"onCetakJobList"}},{text:"Format II",action:2,listeners:{scope:a.getController(),click:"onCetakJobList"}}]}}]},listeners:{tindakanselected:"onSelectTindakanMedis"}},{region:"center",xtype:"com-form",reference:"hasilrad",viewModel:{data:{formConfig:{"final":false,batalFinal:false}}},title:"Hasil Radiologi",fullscreenEnabled:true,header:{items:[{xtype:"button",text:"Final",iconCls:"x-fa fa-check",ui:"soft-cerulen",bind:{hidden:"{!formConfig.final}"},tooltip:"Final",handler:"onFinal"},{xtype:"button",iconCls:"x-fa fa-chain-broken",tooltip:"Batalkan Final",bind:{hidden:"{!formConfig.batalFinal}"},ui:"soft-red",handler:"onBatalFinal"}]},layout:"border",items:[{xtype:"form-hasil-rad",reference:"formhasilrad",border:false,region:"center"}]},{region:"east",xtype:"layanan-radiologi-perujuk-form",width:350,split:{size:3},collapsed:true,collapsible:true}];a.callParent()},formHasilRadConfig:{},hasilRadRecord:undefined,load:function(d){var g=this,b=g.getViewModel(),c=b.get("formConfig"),h=g.down("form-hasil-rad"),j=g.down("layanan-radiologi-perujuk-form");h.setFormConfig({viewOnly:true,simpan:false,cetak:false,kirim:false});if(!c.riwayat){var a=g.down("tindakan-medis-list");if(d){var c=b.get("formConfig");b.set("kunjungan",d);h.kunjungan=d;a.setParams({STATUS:1});a.loadStore(d);h.setDokterRuangan(d.get("RUANGAN"));h.createRecord({});j.loadById({NOMOR:d.get("REF")})}}else{g.hasilRadRecord=d;if(d){var i=Ext.create("data.model.HasilRad",g.getReferensi(d.getData(),"TINDAKAN_MEDIS")),f=g.getReferensi(i.getData(),"KUNJUNGAN"),e=g.getController();e.onSelectTindakanMedis(null,i);j.loadById({NOMOR:f.REF})}}}});Ext.define("berkas.klaim.obat.radiologi.WorkspaceRadController",{extend:"Ext.app.ViewController",alias:"controller.berkas-klaim-obat-radiologi-workspacerad",tindakanMedis:undefined,onBeforeLoadViewer:Ext.emptyFn,init:function(){var c=this,b=c.getView(),a=b.down("[reference=hasilrad]"),d=b.getPropertyConfig("10")=="TRUE";a.setFormConfig({viewer:d,btnViewer:d,kirim:false})},onSelectTindakanMedis:function(k,d){var g=this,a=g.getViewModel(),b=a.get("formConfig"),j=a.get("store"),i=g.getView(),h=g.getReferences();if(d){var c={url:webservice.location+"layanan/viewerad?TINDAKAN_MEDIS="+d.get("ID"),id:d.get("ID"),embedded:true};if(!b.riwayat){h.listindakanmedist.setDisabled(true)}g.tindakanMedis=d;if(!b.riwayat){j.setQueryParams({TINDAKAN_MEDIS:d.get("ID")});j.load({callback:function(m,l,n){var e=1;if(n){e=m[0].get("STATUS");h.formhasilrad.loadRecord(m[0])}else{h.formhasilrad.createRecord({TINDAKAN_MEDIS:d.get("ID")})}h.formhasilrad.setFormConfig({viewOnly:e==2,simpan:e==1,cetak:true,kirim:false});h.hasilrad.setFormConfig({"final":i.app.xpriv("110901",false)&&e==1,batalFinal:i.app.xpriv("110902",false)&&e==2,kirim:false});h.formhasilrad.focus("KLINIS");if(!b.riwayat){h.listindakanmedist.setDisabled(false)}}})}else{if(i.hasilRadRecord){h.hasilrad.setFormConfig({"final":false,batalFinal:false,kirim:false});h.formhasilrad.loadRecord(i.hasilRadRecord)}}try{if(i.getPropertyConfig("10")=="TRUE"){g.onBeforeLoadViewer(c);h.viewer.load(c.url)}}catch(f){console.log("Error load pacs viewer: "+f.message)}}},onViewer:function(){var b=this,a=b.getView();try{if(a.getPropertyConfig("10")=="TRUE"){var d={url:webservice.location+"layanan/viewerad?TINDAKAN_MEDIS="+b.tindakanMedis.get("ID"),externalHandler:false,id:b.tindakanMedis.get("ID"),embedded:false};b.onBeforeLoadViewer(d);if(!d.externalHandler){window.open(d.url,"_blank","toolbar=no,location=no,scrollbars=yes,resizable=yes,fullscreen=yes")}}}catch(c){console.log("Error load pacs viewer: "+c.message)}},onCetakJobList:function(i){var f=this,b=f.getViewModel(),e=b.get("kunjungan"),g=f.getView(),d="Word",c="docx",a=true,h="Cetak Job List Radiologi";g.showMessageBox({title:h,ui:"window-blue",message:"Tekan tombol Yes/Ya utk cetak langsung<br/>Tekan tombol No/Tidak untuk Preview",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"yes",animateTarget:i,fn:function(j){if(j!="yes"){d="Pdf";c="pdf";a=false}g.cetak({NAME:"layanan.CetakJobListRad",TYPE:d,EXT:c,PARAMETER:{PKUNJUNGAN:e.get("NOMOR"),PJENIS:i.action},REQUEST_FOR_PRINT:a,PRINT_NAME:"CetakJobList"},function(k){g.printPreview(h,k)})}})},onFinal:function(d){var f=this,a=f.getView(),e=f.getViewModel(),h=e.get("kunjungan"),b=f.getReferences(),g=b.formhasilrad.getRecord(),c=g.get("STATUS");a.showMessageBox({title:"Final Hasil Radiologi: "+f.tindakanMedis.get("TINDAKAN_DESKRIPSI"),ui:"window-blue",message:"Anda yakin untuk memfinalkan hasil radiologi ?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"yes",animateTarget:d,fn:function(i){if(i==="yes"){g.showError=true;g.animateTarget=d;g.scope=f;g.set("STATUS",2);g.save({callback:function(j,k,l){if(l){a.notifyMessage("Hasil Radiologi telah telah difinalkan");a.load(h)}else{g.set("STATUS",c)}}})}else{g.set(g,c)}}})},onBatalFinal:function(d){var f=this,a=f.getView(),e=f.getViewModel(),h=e.get("kunjungan"),b=f.getReferences(),g=b.formhasilrad.getRecord(),c=true;if(a.app){c=!a.app.xpriv("110902")}if(c){a.notifyMessage("Anda tidak memiliki Hak Akses untuk melakukan Pembatalan final hasil!");return}a.showMessageBox({title:"Pembatalan Final Hasil",message:"Anda yakin ingin membatalkan final hasil?",ui:"window-red",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:d,fn:function(i){if(i==="yes"){a.openDialog("",true,150,100,{xtype:"pendaftaran-pembatalan-final_hasil-form",title:"Pembatalan Final Hasil",ui:"panel-red",showCloseButton:true},function(j,l){var k=l.down("pendaftaran-pembatalan-final_hasil-form");k.on({close:function(){l.close()},save:function(o,m,n){a.setFormConfig({viewOnly:false,simpan:true});g.load({success:function(p,q){a.load(h)}});l.close()}});k.createRecord({KUNJUNGAN:h.get("NOMOR"),REF:g.get("ID"),TANGGAL:a.getSysdate()})})}}})}});Ext.define("berkas.klaim.pasien.Form",{extend:"com.Form",alias:"widget.berkas-klaim-pasien-form",viewModel:{formulas:{getNamaLengkap:function(c){var b=c("record.REFERENSI.PENDAFTARAN.REFERENSI.PASIEN"),d=b.GELAR_DEPAN||"",a=b.NAMA||"",e=b.GELAR_BELAKANG||"";d=d==""?"":d+". ";e=e==""?"":", "+e;return d+a+e},getTempatLahir:function(c){var b=c("record.REFERENSI.PENDAFTARAN.REFERENSI.PASIEN"),e=b.REFERENSI,a=b.TEMPAT_LAHIR,d=e.TEMPATLAHIR?e.TEMPATLAHIR.DESKRIPSI:"";return Ext.isNumeric(a)?d:a},getTglLahir:function(b){var a=b("record.REFERENSI.PENDAFTARAN.REFERENSI.PASIEN"),c=Ext.Date.parse(a.TANGGAL_LAHIR,"Y-m-d H:i:s");return Ext.Date.format(c,"d F Y")},getKontak:function(b){var a=b("record.REFERENSI.PENDAFTARAN.REFERENSI.PASIEN"),c="";if(Ext.isArray(a.KONTAK)){a.KONTAK.forEach(function(d){if(d.JENIS==3){c=d.NOMOR}})}return c},getStatus:function(c){var b=c("record.REFERENSI.PENDAFTARAN.REFERENSI.PASIEN"),d=b.REFERENSI,a=d.STATUS?d.STATUS.DESKRIPSI:"";return a},getPenjamin:function(b){var d=b("record.JENIS"),c=b("record.REFERENSI.PENDAFTARAN.REFERENSI.PASIEN.KARTUASURANSI"),a="";if(Ext.isArray(c)){c.forEach(function(e){if(d==e.JENIS){a=e.REFERENSI.PENJAMIN.DESKRIPSI}})}return a},getPenjaminNoKartu:function(b){var d=b("record.JENIS"),c=b("record.REFERENSI.PENDAFTARAN.REFERENSI.PASIEN.KARTUASURANSI"),a="";if(Ext.isArray(c)){c.forEach(function(e){if(d==e.JENIS){a=e.NOMOR}})}return a},getPenjaminJenis:function(b){var d=b("record"),c=d.get("REFERENSI"),a=c.JENIS_PESERTA?c.JENIS_PESERTA.DESKRIPSI:"";return a},getPenjaminKelas:function(b){var d=b("record"),c=d.get("REFERENSI"),a=c.KELAS?c.KELAS.DESKRIPSI:"";return a},getStatusGrouping:function(b){var c=b("record.REFERENSI.PENDAFTARAN.REFERENSI"),a=c.INACBG?(c.INACBG.STATUS==1?"Final Grouping":"Grouping belum Final"):"Belum di grouping";return a},getKelasKlaim:function(b){var d=b("record"),c=d.get("REFERENSI"),a=c.KELAS_KLAIM?c.KELAS_KLAIM.DESKRIPSI:"";return a}}},bodyStyle:"background: white",bodyPadding:15,layout:{type:"vbox",align:"stretch"},defaults:{xtype:"container",layout:"hbox",plugins:"responsive",responsiveConfig:{"width < 600":{layout:{type:"vbox",align:"stretch"},flex:0}}},initComponent:function(){var a=this;a.items=[{items:[a.createLabelField("No. RM:","{record.REFERENSI.PENDAFTARAN.REFERENSI.PASIEN.NORM}",{margin:"0 25 0 0"}),a.createLabelField("Nama:","{getNamaLengkap}",{margin:"0 25 0 0"}),a.createLabelField("Tempat / Tanggal Lahir:","{getTempatLahir}, {getTglLahir}",{margin:"0 25 0 0"}),a.createLabelField("Alamat:","{record.REFERENSI.PENDAFTARAN.REFERENSI.PASIEN.ALAMAT}",{margin:"0 25 0 0"}),a.createLabelField("Kontak:","{getKontak}",{margin:"0 25 0 0"}),a.createLabelField("Status:","{getStatus}",{margin:"0 25 0 0"})]},{margin:"5 0 0 0",items:[a.createLabelField("Penjamin:","{getPenjamin}",{margin:"0 25 0 0"}),a.createLabelField("No. Kartu:","{getPenjaminNoKartu}",{margin:"0 25 0 0"}),a.createLabelField("No. SEP:","{record.NOMOR}",{margin:"0 25 0 0"}),a.createLabelField("Jenis Peserta:","{getPenjaminJenis}",{margin:"0 25 0 0"}),a.createLabelField("Kelas Hak:","{getPenjaminKelas}",{margin:"0 25 0 0"}),a.createLabelField("Status Grouping:","{getStatusGrouping}",{margin:"0 25 0 0"}),a.createLabelField("Kelas Klaim:","{getKelasKlaim}",{margin:"0 25 0 0"})]}];a.callParent()},createLabelField:function(b,e,d){var a=d||{},c={xtype:"container",layout:{type:"vbox",align:"stretch"},defaultType:"component",margin:"0 0 5 0",items:[{html:b,style:"font-size: 12px; color: gray"},{bind:"<div style='white-space:normal !important;'>"+e+"</div>",style:"font-size: 14px;",margin:"0 0 5 0"}]};return Ext.apply(c,a)}});Ext.define("berkas.klaim.pemeriksaan.Grid",{extend:"com.Grid",alias:"widget.berkas-klaim-pemeriksaan-grid",controller:"berkas-klaim-pemeriksaan-grid",viewModel:{data:{listConfig:{histo:{hidden:true,data:null},sitologi:{hidden:true,data:null},ihc:{hidden:true,data:null},sst:{hidden:true,data:null},hasilpemeriksaan:{hidden:true,menus:[]}}},stores:{store:{type:"berkas-klaim-pemeriksaan-store",pageSize:300}}},title:"Daftar Pemeriksaan / Tindakan",iconCls:"x-fa fa-stethoscope",header:{height:37,items:[{xtype:"button",text:"Lihat Hasil Histo",ui:"soft-blue",title:"HISTOPATOLOGI",cetakHasil:"CetakHasilHistoPatologi",handler:"onLihatHasilPA",bind:{hidden:"{listConfig.histo.hidden}"}},{xtype:"button",text:"Lihat Hasil Sitologi",ui:"soft-green",title:"SITOLOGI",cetakHasil:"CetakHasilSitologi",handler:"onLihatHasilPA",bind:{hidden:"{listConfig.sitologi.hidden}"}},{xtype:"button",text:"Lihat Hasil IHC",ui:"soft-red",title:"IMUNOHISTOKIMIA",cetakHasil:"CetakHasilIHC",handler:"onLihatHasilPA",bind:{hidden:"{listConfig.ihc.hidden}"}},{xtype:"button",text:"Lihat Hasil Evaluasi SST",ui:"soft-cyan",handler:"onLihatHasilSST",bind:{hidden:"{listConfig.sst.hidden}"}},{xtype:"button",text:"Lihat Hasil Pemeriksaan",ui:"soft-red",bind:{hidden:"{listConfig.hasilpemeriksaan.hidden}",menu:"{listConfig.hasilpemeriksaan.menus}"}}]},kunjungan:undefined,bufferedRenderer:false,columns:[{xtype:"templatecolumn",flex:1,tpl:new Ext.XTemplate('<div style="font-size: 14px; font-weight: bold; white-space:normal !important;">{TINDAKAN_DESKRIPSI}</div><div style="font-size: 12px; white-space:normal !important;">{[this.tanggalFormat(values.TANGGAL)]}</div>')},{xtype:"widgetcolumn",widget:{xtype:"fieldcontainer",defaultType:"button",layout:{type:"vbox",align:"stretch"},defaults:{padding:2},items:[{text:"Lihat Hasil",ui:"soft-green",action:0,cetakHasil:"CetakHasilLab",handler:"onLihatHasil"},{text:"Laporan",ui:"soft-gray",action:1,handler:"onLaporan"}]},onWidgetAttach:"onWidgetAttach"}],onBeforeLoad:function(e,c,a){var h={STATUS:1};e.setParams(h);if(e.kunjungan){var d=e.getReferensi(e.kunjungan.getData(),"HASIL_PA"),b=e.getReferensi(e.kunjungan.getData(),"HASIL_SST"),g=e.getReferensi(e.kunjungan.getData(),"HASIL_PEMERIKSAAN");e.setListConfig({histo:{hidden:true,data:null},sitologi:{hidden:true,data:null},ihc:{hidden:true,data:null},sst:{hidden:true,data:null},hasilpemeriksaan:{hidden:true,menus:[]}});if(d){if(Ext.isArray(d)){d.forEach(function(j,i){if(j.JENIS_PEMERIKSAAN==1){e.setListConfig({histo:{hidden:false,data:j}})}if(j.JENIS_PEMERIKSAAN==2){e.setListConfig({sitologi:{hidden:false,data:j}})}if(j.JENIS_PEMERIKSAAN==3){e.setListConfig({ihc:{hidden:false,data:j}})}})}}if(b){e.setListConfig({sst:{hidden:false,data:b}})}if(g){if(Ext.isArray(g)){if(g.length>0){var f=[];g.forEach(function(j,i){f.push({text:j.TITLE,reportParams:j,handler:"onLihatHasilPemeriksaan"})});e.setListConfig({hasilpemeriksaan:{hidden:false,menus:f}})}}}}}});Ext.define("berkas.klaim.pemeriksaan.GridController",{extend:"Ext.app.ViewController",alias:"controller.berkas-klaim-pemeriksaan-grid",service:undefined,init:function(){this.service=Ext.create("berkas.klaim.Service")},onLihatHasil:function(c){var d=this,b=d.getView(),e=b.kunjungan,a=c.ownerCt.getWidgetRecord();if(e){if(e.get("JENIS_KUNJUNGAN")==4){b.cetak({TITLE:"HASIL LABORATORIUM PK",NAME:"layanan.CetakHasilLab",TYPE:"Pdf",EXT:"pdf",PARAMETER:{PNOMOR:e.get("NOMOR"),PTINDAKAN:a.get("ID"),PFORMAT:1},FINAL:1,DOCUMENT_STORAGE:{REF_ID:e.get("NOMOR"),DOCUMENT_DIRECTORY_ID:4},REQUEST_FOR_PRINT:false,PRINT_NAME:"CetakHasil"});return}if(e.get("JENIS_KUNJUNGAN")==5){b.cetak({TITLE:"HASIL RADIOLOGI",NAME:"layanan.CetakHasilRad",TYPE:"Pdf",EXT:"pdf",PARAMETER:{PTINDAKAN:a.get("ID")},FINAL:1,DOCUMENT_STORAGE:{REF_ID:a.get("ID"),DOCUMENT_DIRECTORY_ID:7},REQUEST_FOR_PRINT:false,PRINT_NAME:"CetakHasil"})}}},onLihatHasilPA:function(b){var d=this,a=d.getView(),c=d.getViewModel(),f=c.get("listConfig"),g=a.kunjungan;if(g){if(g.get("JENIS_KUNJUNGAN")==4){var e=null;if(b.title=="HISTOPATOLOGI"){e=f.histo.data}if(b.title=="SITOLOGI"){e=f.sitologi.data}if(b.title=="IMUNOHISTOKIMIA"){e=f.ihc.data}if(e){a.cetak({TITLE:"HASIL LABORATORIUM "+b.title,NAME:"layanan.laboratorium.pa."+b.cetakHasil,TYPE:"Pdf",EXT:"pdf",PARAMETER:{PID:e.ID,CETAK_HEADER:1},FINAL:1,DOCUMENT_STORAGE:{REF_ID:e.ID,DOCUMENT_DIRECTORY_ID:5},REQUEST_FOR_PRINT:false,PRINT_NAME:"CetakHasil"});return}}}},onLihatHasilSST:function(b){var d=this,a=d.getView(),c=d.getViewModel(),f=c.get("listConfig"),e=f.sst.data;a.cetak({TITLE:"HASIL EVALUASI SST",NAME:"layanan.CetakHasilEvaluasiSST",TYPE:"Pdf",EXT:"pdf",PARAMETER:{PID:e.ID},FINAL:1,DOCUMENT_STORAGE:{REF_ID:e.KUNJUNGAN,DOCUMENT_DIRECTORY_ID:16},REQUEST_FOR_PRINT:false,PRINT_NAME:"CetakbHasil"})},onLihatHasilPemeriksaan:function(b){var c=this,a=c.getView(),d={TYPE:"Pdf",EXT:"pdf",FINAL:1,REQUEST_FOR_PRINT:false,PRINT_NAME:"CetakHasil"};d=Ext.apply(d,b.reportParams);a.cetak(d)},onLaporan:function(b){var c=this,a=c.getView(),e=a.kunjungan,d=b.ownerCt.getWidgetRecord();if(e){c.service.laporan(e.get("NOMOR"),d.get("TINDAKAN"),function(g,f){if(g){a.cetak({TITLE:"LAPORAN OPERASI / TINDAKAN INVASIF",NAME:"mr.CetakLaporanOperasi",TYPE:"Pdf",EXT:"pdf",PARAMETER:{PID:f.data},FINAL:1,DOCUMENT_STORAGE:{REF_ID:f.data,DOCUMENT_DIRECTORY_ID:3},REQUEST_FOR_PRINT:false,PRINT_NAME:"CetakMR"})}})}},onWidgetAttach:function(h,b,a){var e=this,f=e.getView(),d=f.kunjungan,c=b.down("[action=0]"),g=b.down("[action=1]");if(d){var j=true,i;_hiddenLaporan=true;if(d.get("JENIS_KUNJUNGAN")==4||d.get("JENIS_KUNJUNGAN")==5){j=false}c.setHidden(j);if(d.get("JENIS_KUNJUNGAN")==6||d.get("JENIS_KUNJUNGAN")==7||d.get("JENIS_KUNJUNGAN")==8||d.get("JENIS_KUNJUNGAN")==9||d.get("JENIS_KUNJUNGAN")==10||d.get("JENIS_KUNJUNGAN")==12||d.get("JENIS_KUNJUNGAN")==14){_hiddenLaporan=false}g.setHidden(_hiddenLaporan)}}});Ext.define("berkas.klaim.pendukung.Grid",{extend:"com.Grid",alias:"widget.berkas-klaim-pendukung-grid",controller:"berkas-klaim-pendukung-grid",viewModel:{stores:{store:{type:"berkas-klaim-pendukung-store",pageSize:100}}},title:"Dokumen Pendukung",iconCls:"x-fa fa-file-pdf",header:{height:37},kunjungan:undefined,columns:[{xtype:"templatecolumn",flex:1,tpl:new Ext.XTemplate('<div style="font-size: 14px; font-weight: bold; white-space:normal !important;">{id} - {file_name}</div><div style="font-size: 12px; white-space:normal !important;">{file_class}</div><div style="font-size: 12px; white-space:normal !important;">{[this.tanggalFormat(values.dibuat_oleh)]} | {[this.getNamaLengkap(this.getReferensi(values, "PENGGUNA"))]}</div>')},{xtype:"widgetcolumn",widget:{xtype:"fieldcontainer",defaultType:"button",layout:{type:"vbox",align:"stretch"},defaults:{padding:2},items:[{text:"Lihat",ui:"soft-green",action:0,handler:"onLihat"}]}}],onBeforeLoad:function(c,b,a){var d={status:1};c.setParams(d)}});Ext.define("berkas.klaim.pendukung.GridController",{extend:"Ext.app.ViewController",alias:"controller.berkas-klaim-pendukung-grid",onLihat:function(b){var c=this,a=c.getView(),d=b.ownerCt.getWidgetRecord();if(d.get("document_id")){a.printPreviewDocument(b,{ID:d.get("document_id")})}else{a.printPreview(d.get("file_name"),webservice.location+"berkas-klaim/dokumenPendukung/"+d.get("id"))}}});