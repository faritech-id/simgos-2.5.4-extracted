Ext.define("informasi.Workspace",{extend:"com.View",xtype:"workspace-informasi",viewModel:{stores:{store:{data:[{title:"Informasi Pengunjung",id:"ANTRIAN",className:"informasi.pengunjung.Workspace"},{title:"Informasi Tempat Tidur",id:"INFO_TT",className:"informasi.tempattidur.Ruangan"}]}}},controller:"workspace-informasi",autoScroll:true,cls:"laporan-main laporan-dataview",bind:{store:"{store}"},itemSelector:"div.thumb-wrap-info",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="thumb-wrap-info">','<a class="thumb" href="#">','<div class="thumb-icon"></div>','<div class="thumb-title-container">','<div class="thumb-title"><strong>{title}</strong></div>',"</div>","</a>","</div>","</tpl>"),listeners:{select:"onSelect"}});Ext.define("informasi.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.workspace-informasi",ruangans:undefined,onSelect:function(b,d){var c=this,a=c.getView();if(d.getId()=="INFO_TT"){this.onInfoTt(b)}else{a.openDialog("",true,0,0,{xtype:"ruangan-list",ui:"panel-cyan",showCloseButton:true,title:"Pilih Ruangan",hideHeaders:true,ruanganAkses:false,checkboxModel:true,flex:1,selModel:{selType:"checkboxmodel",mode:"MULTI",checkOnly:true},listeners:{scope:c,select:"onSelectRuangan",deselect:"onDeselectRuangan",itemclick:"onItemClick"},bbar:{xtype:"toolbar",ui:"toolbar-blue",items:["->",{xtype:"checkbox",reference:"kunjungan",boxLabel:"Tampilkan kunjungan yang masih dilayani",margin:{right:15}},{xtype:"combobox",reference:"waktuperpindahan",fieldLabel:"Waktu Perpindahan Ruangan",labelWidth:180,value:15,width:253,store:{data:[{ID:5},{ID:10},{ID:15},{ID:20},{ID:25},{ID:30}]},displayField:"ID",valueField:"ID"},{xtype:"component",html:"detik"},{text:"Mulai",listeners:{scope:c,click:"onMulai"}}]}},function(e,i){var g=i.down("ruangan-list"),j=i.down("[reference=kunjungan]"),f=i.down("[reference=waktuperpindahan]");g.setParams({TREE:0,JENIS:5,NOT:Ext.JSON.encode({JENIS_KUNJUNGAN:[0,2,3]}),STATUS:1});f.on("select",function(k,l){c.waktuPerpindahan=l.get("ID")});g.loadStore();g.doAfterLoad=function(k,l){c.ruangans=l;Ext.Array.each(c.ruangans,function(m){m.set("checked",false)});c.waktuPerpindahan=f.getSelection().get("ID");c.kunjungan=j}});a.deselect(d)}},onSelectRuangan:function(a,b){b.set("checked",true)},onDeselectRuangan:function(a,b){b.set("checked",false)},onItemClick:function(){},onMulai:function(){var b=this,a=b.getView(),c=[];Ext.Array.each(b.ruangans,function(d){if(d.get("checked")){c.push(d)}});if(c.length==0){a.notifyMessage("Silahkan pilih salah satu ruangan yang ingin ditampilkan","danger-blue");return}a.openDialog("",true,0,0,{xtype:"workspace-info-pengunjung",hideHeader:true},function(d,f){var e=f.down("workspace-info-pengunjung");e.load(c,b.waktuPerpindahan,b.kunjungan)})},onInfoTt:function(c){var b=this,a=b.getView();a.openDialog("",true,"100%","100%",{xtype:"informasi-tempattidur-ruangan",ui:"panel-cyan",scrollable:true,showCloseButton:true},function(f,e){var d=e.down("informasi-tempattidur-ruangan");d.onLoadRecord({})})}});Ext.define("informasi.monitoring.sikepo.Grid",{extend:"com.Grid",xtype:"informasi-monitoring-sikepo-grid",controller:"informasi-monitoring-sikepo-grid",viewModel:{stores:{store:{type:"monitoringsikepo-store"}}},border:false,tbar:[{xtype:"container",layout:{align:"stretch",type:"hbox"},flex:1,items:[{name:"TANGGAL",emptyText:"Tanggal",xtype:"datefield",format:"d-m-Y",value:new Date(),maxValue:new Date(),margin:"0 10 0 0",flex:1},{xtype:"textfield",name:"PCARI",emptyText:"Cari RM/Nama Pasien",margin:"0 10 0 0",reference:"refnormnamapasien",flex:2},{xtype:"ruangan-combo",name:"RUANGAN",params:{STATUS:1,JENIS:5,JENIS_KUNJUNGAN:3},hideTrigger:false,firstLoad:true,forceSelection:true,margin:"0 10 0 0",flex:1},{xtype:"dokter-combo",name:"DOKTER",params:{STATUS:1},hideTrigger:false,firstLoad:true,forceSelection:true,margin:"0 10 0 0",flex:1},{xtype:"combobox",store:Ext.create("Ext.data.Store",{fields:["id","deskripsi"],data:[{id:"1",deskripsi:"Belum Rencana Pulang"},{id:"2",deskripsi:"Rencana Pulang"}]}),name:"RENCANAPULANG",queryMode:"local",reference:"refrencanapulang",displayField:"deskripsi",valueField:"id",emptyText:"Status Rencana Pulang",value:0,forceSelection:true,margin:"0 10 0 0",flex:1},{xtype:"combobox",store:Ext.create("Ext.data.Store",{fields:["id","deskripsi"],data:[{id:"1",deskripsi:"<= 75",color:"#90EE90"},{id:"2",deskripsi:"<= 90",color:"#CBC3E3"},{id:"3",deskripsi:"> 90",color:"#FFA500"}]}),name:"STATUSTARIF",queryMode:"local",reference:"refstatustarif",displayField:"deskripsi",valueField:"id",emptyText:"Status Tarif",value:0,forceSelection:true,margin:"0 10 0 0",tpl:['<ul class="x-list-plain">','<tpl for=".">','<li class="x-boundlist-item listItmes" style="background-color:{color}">{deskripsi}</li>',"</tpl>","</ul>"],flex:1},{xtype:"combobox",store:Ext.create("Ext.data.Store",{fields:["id","deskripsi"],data:[{id:"1",deskripsi:"0-7 hr",color:"#008000"},{id:"2",deskripsi:"8-14 hr",color:"#FFFF00"},{id:"3",deskripsi:"> 14 hr",color:"#FF0000"}]}),name:"STATUSLOS",queryMode:"local",reference:"refstatuslos",displayField:"deskripsi",valueField:"id",emptyText:"Status LOS",value:0,forceSelection:true,margin:"0 10 0 0",tpl:['<ul class="x-list-plain">','<tpl for=".">','<li class="x-boundlist-item listItmes" style="background-color:{color}">{deskripsi}</li>',"</tpl>","</ul>"],flex:1},{xtype:"combobox",store:Ext.create("Ext.data.Store",{fields:["id","deskripsi"],data:[{id:"1",deskripsi:"Belum Grouping"},{id:"2",deskripsi:"Belum Final Grouping"},{id:"3",deskripsi:"Final Grouping"}]}),name:"STATUSGROUPING",queryMode:"local",reference:"refstatusgrouping",displayField:"deskripsi",valueField:"id",emptyText:"Status Grouping",value:0,forceSelection:true,margin:"0 10 0 0",flex:1},{xtype:"button",iconCls:"x-fa fa-search",width:35,handler:"onCari"}]}],columns:[{xtype:"rownumberer",text:"No",align:"left",width:50},{text:"Instalasi",align:"left",width:200,dataIndex:"INSTALASI"},{text:"Unit",align:"left",width:200,dataIndex:"UNIT"},{text:"Sub Unit",align:"left",width:200,dataIndex:"SUBUNIT"},{text:"No. RM",align:"left",width:100,dataIndex:"NORM"},{text:"Nama Pasien",align:"left",flex:1,dataIndex:"NAMALENGKAP"},{xtype:"datecolumn",dataIndex:"TGLMASUK",format:"d/m/Y",text:"Tgl Masuk RS",align:"left",width:100},{text:"Status LOS",align:"left",width:100,dataIndex:"IDLOS",renderer:"onRendererStatusLos"},{text:"Aksi",width:100,xtype:"widgetcolumn",align:"center",widget:{xtype:"fieldcontainer",defaultType:"button",layout:{type:"hbox",align:"stretch"},items:[{ui:"soft-cyan",tooltip:"Tagihan",iconCls:"fa fa-ils",rptName:"CetakRincianPasienPerGroup",handler:"onViewTagihanMonitoringSikepo",margin:"0 10 0 0"},{ui:"soft-green",tooltip:"Kasus Sejenis",iconCls:"fa fa-arrows-alt",handler:"onViewKasusSejenis"}]}}],plugins:[{ptype:"rowexpander",rowBodyTpl:new Ext.XTemplate("<p><b>LOS:</b> {LOS}</p>","<p><b>DPJP:</b> {DR_AKHIR}</p>","<p><b>Cara Bayar:</b> {CARABAYAR}</p>","<p><b>Rencana Pulang:</b> {[this.rencanaPulang(values.STATUS_RENCANA_PULANG)]}</p>","<p><b>Code CBG:</b> {CODECBG}</p>","<p><b>Deskripsi CBG:</b> {DESKRIPSICBG}</p>","<p><b>Hak Kelas:</b> {KELASHAK}</p>","<p><b>Kelas Rawat Tertinggi:</b> {KELASRAWATMAX}</p>","<p><b>Ket. Kelas Rawat:</b> {KETKELASRAWATMAX}</p>","<p><b>Tarif IRD:</b> {[this.tarif(values.TAGIHANIRD)]}</p>","<p><b>Tarif Perawatan:</b> {[this.tarif(values.TAGIHANRI)]}</p>","<p><b>Tarif Total:</b> {[this.tarif(values.TOTALTARIFRS)]}</p>","<p><b>Nilai Jaminan:</b> {[this.tarif(values.NILAIJAMINAN)]}</p>","<p><b>Status Grouping:</b> {[this.statusGrouping(values.ID_STATUS_GROUPING)]}</p>","<p><b>Tgl Grouping:</b> {[this.tanggalGrouping(values.TANGGAL_GROUPING)]}</p>",{rencanaPulang:function(a){return a==1?"Belum Rencana Pulang":"Rencana Pulang"},tarif:function(a){return Ext.util.Format.number(a,"0,000")},tanggalGrouping:function(b){var a=Ext.Date.parse(b,"Y-m-d H:i:s");return Ext.Date.format(a,"d-m-Y H:i:s")},statusGrouping:function(a){return a==1?"Belum Grouping":(a==2?"Belum Final Grouping":"Final Grouping")}})}],onBeforeLoad:function(g,a,i){var b=g.down("[name=TANGGAL]").getValue(),d=g.down("[name=PCARI]").getValue(),c=g.down("[name=DOKTER]").getValue()?g.down("[name=DOKTER]").getValue():0,e=g.down("[name=RUANGAN]").getValue()?g.down("[name=RUANGAN]").getValue():1,l=g.down("[name=STATUSLOS]").getValue()?g.down("[name=STATUSLOS]").getValue():0,j=g.down("[name=STATUSTARIF]").getValue()?g.down("[name=STATUSTARIF]").getValue():0,k=g.down("[name=RENCANAPULANG]").getValue()?g.down("[name=RENCANAPULANG]").getValue():0,f=g.down("[name=STATUSGROUPING]").getValue()?g.down("[name=STATUSGROUPING]").getValue():0;if(Ext.Date.format(b,"Y-m-d")==Ext.Date.format(g.getSysdate(),"Y-m-d")){tgl=Ext.Date.format(g.getSysdate(),"Y-m-d")}else{tgl=Ext.Date.format(b,"Y-m-d")}g.setParams({TANGGAL:tgl,CARAKELUAR:0,RUANGAN:e,LAPORAN:3,CARABAYAR:0,DOKTER:c,STATUSLOS:l,STATUSTARIF:j,RENCANAPULANG:k,PCARI:d,STATUSGROUPING:f,MONITORING:1})}});Ext.define("informasi.monitoring.sikepo.GridController",{extend:"Ext.app.ViewController",alias:"controller.informasi-monitoring-sikepo-grid",onRendererStatusLos:function(d,c){if(d==1){var a="0-7 hr";c.style="background-color:green;"}else{if(d==2){var a="8-14 hr";c.style="background-color:yellow;"}else{var a="> 14 hr";c.style="background-color:red;"}}return a},onViewTagihanMonitoringSikepo:function(a){h=a.ownerCt.getWidgetRecord();this.viewTagihanMonitoringSikepo(h,a.rptName)},onCari:function(a){this.cari()},onViewKasusSejenis:function(a){var b=a.ownerCt.getWidgetRecord();this.openWindow(a,false,b)},privates:{viewTagihanMonitoringSikepo:function(d,g){var f=this,a=f.getView(),b="Word",e="docx",i=true,c="Cetak Rincian";a.showMessageBox({title:c,message:"Tekan tombol Yes/Ya utk cetak langsung<br/>Tekan tombol No/Tidak untuk Preview",ui:"window-cyan",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"yes",animateTarget:f,fn:function(j){if(j!="yes"){b="Pdf";e="pdf";i=false}a.cetak({NAME:"pembayaran."+a.kode+g,TYPE:b,EXT:e,PARAMETER:{PTAGIHAN:d.get("TAGIHAN"),PKASIR:a.app.usrNm,PSTATUS:1},REQUEST_FOR_PRINT:i,PRINT_NAME:"CetakRincian"},function(k){a.printPreview(c,k)})}})},cari:function(){var b=this,a=b.getView();a.clearParams();a.load()},openWindow:function(c,b,e){var d=this,a=d.getView();a.openDialog("",true,"90%","70%",{title:"Kasus Sejenis Kode CBG "+(e.get("CODECBG")==null?"":e.get("CODECBG"))+" | "+(e.get("DESKRIPSICBG")==null?"":e.get("DESKRIPSICBG"))+"",ui:"panel-cyan",showCloseButton:true,xtype:"informasi-monitoring-sikepo-kasussejenis"},function(f,i){var g=i.down("informasi-monitoring-sikepo-kasussejenis");g.setGridConfig({paging:true});g.load({PCODE_CBG:e.get("CODECBG"),KASUS_SEJENIS:1})})}}});Ext.define("informasi.monitoring.sikepo.KasusSejenis",{extend:"com.Grid",xtype:"informasi-monitoring-sikepo-kasussejenis",viewModel:{stores:{store:{type:"monitoringsikepo-store"}}},columns:[{xtype:"rownumberer",text:"No",align:"left",width:50},{text:"Norm",align:"left",width:100,dataIndex:"NORM"},{text:"Nopen",align:"left",width:100,dataIndex:"NOPEN"},{xtype:"datecolumn",dataIndex:"TGLREG",format:"d/m/Y H:i:s",text:"Tgl Registrasi",align:"left",width:200},{xtype:"datecolumn",dataIndex:"TGLKELUAR",format:"d/m/Y H:i:s",text:"Tgl Keluar",align:"left",width:200},{text:"Kode CBG",align:"left",width:100,dataIndex:"CODECBG"},{text:"Diagnosa",align:"left",flex:1,dataIndex:"DIAGNOSA"},{text:"Prosedur",align:"left",flex:1,dataIndex:"PROSEDUR"}]});Ext.define("informasi.monitoring.sikepo.Workspace",{extend:"com.Form",xtype:"informasi-monitoring-sikepo-workspace",border:false,layout:"border",items:[{region:"center",flex:1,xtype:"informasi-monitoring-sikepo-grid"}],load:function(a){var c=this,b=c.down("informasi-monitoring-sikepo-grid");b.setGridConfig({paging:true});b.load()}});Ext.define("informasi.pengunjung.DataView",{extend:"com.Grid",alias:"widget.informasi-pengunjung",viewModel:{data:{jenis:"Pengunjung",ruangan:undefined,hideIdentitasPasien:true},stores:{store:{type:"antrian-ruangan-store",queryParams:{STATUS:1}}}},bind:{store:"{store}",title:"<div style='font-weight: bold; border:0px;background: -webkit-linear-gradient(top, #fcfff4 0%,#dfe5d7 40%,#b3bead 100%); border-left: 10px solid #475868;font-size: 20px;padding: 10px 0px 10px 10px;'>{jenis} {ruangan.DESKRIPSI}</div>"},margin:0,padding:0,bodyStyle:"background-color: #475868;",hideHeaders:true,initComponent:function(){var b=this,a=b.getViewModel();b.columns=[{xtype:"templatecolumn",align:"right",flex:2,tpl:new Ext.XTemplate('<div class="thumb-wrap" style="background-color:{[this.getColor(values)]};">','<div class="thumb" style="margin: 0px; padding: 5px;">','<div style="float: left; font-weight: bold; color:white; font-size: 40px; padding-left: 5px; padding-top: 13px;">{[this.getNomor(values)]}</div>','<div style="font-weight: bold; color:white; font-size: 22px; padding: 5px;"> {[this.getFormatNorm(values.REFERENSI.TUJUAN_PASIEN.REFERENSI.PENDAFTARAN.REFERENSI.PASIEN.NORM)]} {[this.getNamaLengkap(values.REFERENSI.TUJUAN_PASIEN.REFERENSI.PENDAFTARAN.REFERENSI.PASIEN)]}</div>','<div style="font-weight: bold; color: #fad644;font-size: 13px">{[this.getFormatPendaftaran(values.REFERENSI.TUJUAN_PASIEN.REFERENSI.PENDAFTARAN.NOMOR)]} - {[this.tanggalFormat(values.REFERENSI.TUJUAN_PASIEN.REFERENSI.PENDAFTARAN.TANGGAL)]}</div>',"</div>","</div>",{getNomor:function(c){var d=c.POS?c.POS+"-":"";return d==""?c.NOMOR:(d+Ext.String.leftPad(c.NOMOR,3,"0"))},getNamaLengkap:function(f){var i=f.GELAR_DEPAN||"",j=f.NAMA||"",g=f.GELAR_BELAKANG||"";i=i==""?"":i+". ";g=g==""?"":", "+g;return a.get("hideIdentitasPasien")?"":"- "+i+j+g},getFormatPendaftaran:function(c){return c.substring(0,6)+"."+c.substring(6)},getColor:function(d){var e=a.get("jenis"),c=e=="Pengunjung"?"#1c354a":"#044244";return c}})}];b.callParent(arguments);a.set("hideIdentitasPasien",!b.app.xpriv("200101",false))},setRuangan:function(a){if(a){this.getViewModel().set("ruangan",a)}},setJenisDeskripsi:function(a){if(a){this.getViewModel().set("jenis",a)}}});Ext.define("informasi.pengunjung.Workspace",{extend:"com.Form",alias:"widget.workspace-info-pengunjung",controller:"workspace-info-pengunjung",viewModel:{data:{ruangans:[],refreshTime:0,instansi:undefined,infoTeks:""},stores:{store:{type:"instansi-store"}}},layout:{type:"vbox",align:"stretch"},defaults:{border:false},bodyStyle:"background-color:#aa8a51",initComponent:function(){var a=this;a.antrianPanel=Ext.create("informasi.pengunjung.antrian.Panel",{reference:"antrianpanel"});a.antrianPanel.on("destroy",function(){if(a.antrianPanel){a.antrianPanel.stop()}});a.items=[a.layoutHeader(),a.layoutContent(),a.layoutFooter(),a.antrianPanel];a.callParent()},layoutHeader:function(){return{layout:{type:"hbox",align:"middle"},border:false,height:50,bodyStyle:"background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#a90329), color-stop(44%,#8f0222), color-stop(100%,#6d0019));",items:[{xtype:"image",bind:{src:"classic/resources/images/{instansi}.png"},id:"idImage",width:40,border:false,bodyStyle:"background-color:transparent;",margin:"0 5 0 5"},{flex:1,bind:{data:{items:"{store.data.items}"}},tpl:new Ext.XTemplate('<tpl for="items">',"{data.REFERENSI.PPK.NAMA}","</tpl>"),border:false,bodyStyle:"background-color:transparent; font-size: 24px; color: white; padding-top: 15px;",height:50},{xtype:"label",id:"tgl",text:this.getDateIndo(),width:290,border:false,style:"background-color:transparent; font-size: 16px; color: white; "},{bind:{html:"{refreshTime}"},width:60,border:false,height:50,bodyStyle:"background-color:#0d3050; padding-top: 18px; text-align:center; font-family: Walrus Gumbo NF; font-size: 23px;  color: white;"}]}},layoutContent:function(){return{flex:1,layout:{type:"hbox",align:"stretch"},defaults:{flex:1,margin:"0 1 0 1"},border:false,reference:"informasi",items:[{xtype:"informasi-pengunjung",firsLoad:false,border:false,viewConfig:{loadMask:false}},{xtype:"informasi-pengunjung",firstLoad:false,border:false,viewConfig:{loadMask:false}}]}},layoutFooter:function(){return{layout:{type:"hbox",align:"middle"},height:50,border:false,bodyStyle:"background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#356aa0), color-stop(100%,#356aa0));",items:[{xtype:"label",flex:1,style:"background-color:transparent;font-size: 21px;  margin-left: 10px;color: white;",border:false,bind:{html:'<marquee style="height: 50px; padding-top: 16px">{infoTeks}</marquee>'},height:50}]}},getDateIndo:function(){return Ext.Date.format(this.getSysdate(),"l, d F Y H:i:s")},refreshInfoTanggal:function(){Ext.getCmp("tgl").setText(this.getDateIndo())},load:function(e,g,a){var d=this,b=d.getController(),c=d.getViewModel(),f=Ext.create("data.model.InfoTeks",{ID:1});c.set("ruangans",e);b.refreshTimeRuangan=g;b.currentRefreshTimeRuangan=g;b.kunjungan=a;b.mulai();f.load({callback:function(k,i,j){if(j){c.set("infoTeks",k.get("TEKS"))}}})},listeners:{afterrender:"onAfterRender"},runLogo:function(){if(this.deg==360){this.deg=0}else{this.deg+=5}Ext.getCmp("idImage").setStyle("-webkit-transform: rotateY("+this.deg+"deg)")},destroy:function(){if(this.antrianPanel){this.antrianPanel.stop();this.remove(this.antrianPanel);this.antrianPanel=null}this.callParent()}});Ext.define("informasi.pengunjung.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.workspace-info-pengunjung",ruanganLastIdx:0,refreshTimeRuangan:10,currentRefreshTimeRuangan:10,kunjungan:false,onAfterRender:function(){var d=this,b=d.getViewModel(),a=b.get("store"),c=Ext.getStore("instansi");if(c){b.set("store",c);new Ext.util.DelayedTask(function(){b.set("instansi",c.getAt(0).get("PPK"))}).delay(1000)}else{a.doAfterLoad=function(e,g,f,i){if(i){if(g.length>0){b.set("instansi",g[0].get("PPK"))}}};a.load()}},mulai:function(){var e=this,a=e.getView(),b=e.getReferences(),d=e.getViewModel(),g=d.get("ruangans"),f=a.getPropertyConfig("4")=="TRUE";d.set("refreshTime",e.autoRefreshTime);try{if(f){a.antrianPanel.start(g)}if(e.task==undefined){e.task={run:function(){d.set("refreshTime",e.currentRefreshTimeRuangan);if(e.currentRefreshTimeRuangan==e.refreshTimeRuangan){b.informasi.items.each(function(k,j){var i=g[e.ruanganLastIdx];if(i){k.setRuangan(i);k.clearParams();k.setParams({RUANGAN:i.get("ID"),STATUS:1});if(e.kunjungan.getValue()&&j==1){k.setJenisDeskripsi("Kunjungan");k.setParams({STATUS:2,STATUS_KUNJUNGAN:1})}if(g.length<3){if(k.getStore().getCount()>0){k.reload()}else{k.loadStore()}}else{k.loadStore()}if(!e.kunjungan.getValue()){e.ruanganLastIdx++}}})}if(e.ruanganLastIdx>g.length-1){e.ruanganLastIdx=0}if(e.currentRefreshTimeRuangan==0){e.currentRefreshTimeRuangan=e.refreshTimeRuangan+1}e.currentRefreshTimeRuangan--;e.getView().refreshInfoTanggal()},interval:1000};Ext.TaskManager.start(e.task)}}catch(c){}},destroy:function(){var b=this,a=b.getView();Ext.TaskManager.stop(b.task);b.callParent()}});Ext.define("informasi.pengunjung.antrian.Detail",{extend:"com.Form",alias:"widget.antrian-detail",viewModel:{data:{record:undefined,pasien:undefined,showIdentitasPasien:false},formulas:{getNamaLengkap:function(c){var b=c("pasien"),d=b.GELAR_DEPAN||"",a=b.GELAR_BELAKANG||"";d=d==""?"":d+". ";a=a==""?"":", "+a;return d+b.NAMA+a},getFormatNorm:function(b){var a=b("pasien"),c=a.NORM||0;if(c>0){return this.toFormatNorm(c)}return""},getAntrian:function(b){var a=b("record"),c=a.get("POS")?a.get("POS")+"-":"";return c==""?a.get("NOMOR"):(c+Ext.String.leftPad(a.get("NOMOR"),3,"0"))}},toFormatNorm:function(a){a=Ext.String.leftPad(a,8,"0");a=Ext.String.insert(Ext.String.insert(Ext.String.insert(a,".",2),".",5),".",8);return a}},layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",flex:2,layout:{type:"hbox",align:"stretch"},items:[{xtype:"image",alt:"No Photo",src:"resources/images/nousuario.jpg",width:300,bind:{hidden:"{!showIdentitasPasien}"}},{bind:{html:"{getAntrian}"},flex:1,bodyStyle:"background:transparent; padding-top: 15%; text-align:center; color:#67f328; font-size:230px; font-weight:900; text-shadow: 3px 3px 5px #000000;"}]},{bind:{html:"{getFormatNorm} - {getNamaLengkap}"},height:40,bodyStyle:"padding-top: 0.7%; background:transparent;  font-size:20px; font-weight:500;",bind:{hidden:"{!showIdentitasPasien}"}},{bind:{html:"{record.REFERENSI.RUANGAN.DESKRIPSI}"},flex:1,bodyStyle:"padding-top: 5%; background:transparent;  text-align:center; font-size:120px; font-weight:900; text-shadow: 3px 3px 5px #000000;"}],panggil:function(g){var f=this.getViewModel(),e=this.getReferensi(g.data,"TUJUAN_PASIEN"),c=this.getReferensi(e,"PENDAFTARAN"),a=this.getReferensi(c,"PASIEN"),b=this.getReferensi(g.data,"RUANGAN"),d=this.app.xpriv("200101",false);f.set("record",g);f.set("pasien",a);f.set("showIdentitasPasien",d)}});Ext.define("informasi.pengunjung.antrian.Panel",{extend:"com.Form",alias:"widget.antrian-panel",hidden:true,tts:{integrasi:undefined,service:undefined},viewModel:{stores:{antrians:{type:"panggilan-antrian-ruangan-store",queryParams:{STATUS:1}}}},firstLoad:true,showPanggilAntrian:false,initComponent:function(){var a=this;a.callParent();a.tts.integrasi=a.app.xitr("ID",6);if(a.tts.integrasi){a.tts.service=Ext.create(a.tts.integrasi.NAMA_KLAS,{parent:a,audioCount:1})}a.audios=a.tts.service.getAudios();try{if(a.tts.service){a.add(a.audios)}}catch(b){}},start:function(d){var c=this,b=c.getViewModel(),a=b.get("antrians");if(Ext.isArray(d)){var e="";Ext.Array.each(d,function(g,f){e+="'"+g.get("ID")+"'";if(f<d.length-1){e+=","}});a.queryParams.IN=e;if(c._task==undefined){c._task={run:function(){if(a){try{if(a.getCount()==0){a.removeAll();a.reload()}else{if(!c.showPanggilAntrian){c.callAntrian(a.getAt(0))}}}catch(f){}}},interval:3000}}a.load(function(f,g,i){if(c.firstLoad){c.firstLoad=false;Ext.TaskManager.start(c._task)}})}},stop:function(){if(this._task){this.firstLoad=true;Ext.TaskManager.stop(this._task)}},privates:{callAntrian:function(e){var d=this,c=d.getViewModel(),b=c.get("antrians");if(e){var f=d.getReferensi(e.data,"ANTRIAN"),a=this.getReferensi(f,"RUANGAN");d.showPanggilAntrian=true;if(d.tts.service){d.tts.service.speech(["Pasien Dengan Nomor Antrian",f.POS?f.POS:"",f.POS?Ext.String.leftPad(f.NOMOR,3,"0"):f.NOMOR,"Silahkan Ke",a.DESKRIPSI])}d.openDialog("",true,0,0,{xtype:"antrian-detail",ui:"panel-purple",title:"Panggil Antrian"},function(l,k){var g=k.down("antrian-detail"),i=k.getHeight(),j=k.getActiveAnimation();g.panggil(Ext.create("data.model.AntrianRuangan",f));e.set("STATUS",2);e.save({callback:function(){b.remove(e)}});(new Ext.util.DelayedTask(function(){d.showPanggilAntrian=false;k.close()})).delay(7000)})}}},destroy:function(){if(this.audios){this.remove(this.audios)}this.tts.service.destroy();this.tts.service=undefined;this.callParent()}});Ext.define("informasi.ruangkamartidur.DataView",{extend:"Ext.view.View",alias:"widget.ruangkamartidur-data-view",viewModel:{data:{showIdentitasPasien:false},stores:{store:{type:"informasiruangkamartidur-store",queryParams:{RUANGAN:"",STATUS:0,PASIEN:""}}}},loadMask:false,autoScroll:true,cls:"laporan-main laporan-dataview",bind:{store:"{store}"},itemSelector:"div.thumb-wrap",initComponent:function(){var c=this,b=c.getViewModel(),a=b.get("store");c.tpl=Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="thumb-wrap" style="min-height: 95px; height: 125px; width: 300px">','<a class="thumb" href="#" style="{[this.getBgColor(values)]}">','<div class="thumb-title-medium x-fa fa-bed" style="white-space:normal !important; {[this.getColor(values)]}"><strong>&nbsp;{RUANGAN}</strong></div>','<div class="thumb-title-container">','<div class="thumb-title-medium" style="white-space:normal !important; {[this.getColor(values)]}"><strong>{KAMAR}.{TEMPAT_TIDUR} / {KELAS}</strong></div>','<div class="thumb-title-small" style="{[this.getColor(values)]}">{[this.getInfo(values)]} | {STATUS}</div>',"</div>","</a>","</div>","</tpl>",{getInfo:function(e){var g=b.get("showIdentitasPasien"),i=e.STATUS_ID==2?"<strong>"+e.RESERVASI_NO+"</strong>":(e.STATUS_ID==3?e.NORM:""),j=e.STATUS_ID==2?e.RESERVASI_ATAS_NAMA:(e.STATUS_ID==3?(g?e.NAMA:""):"");if(e.STATUS_ID==3){lpad=Ext.String.leftPad(i,8,"0"),i=Ext.String.insert(Ext.String.insert(Ext.String.insert(lpad,".",2),".",5),".",8)}var f=e.STATUS_ID==2||e.STATUS_ID==3?i+" - "+j:"";return f},getBgColor:function(e){var d="";if(e.STATUS_ID==2){d="#0e9d6f"}if(e.STATUS_ID==3){d="#e13345"}return d==""?"":"background: "+d},getColor:function(e){var d="";if(e.STATUS_ID==2){d="#77f1ca"}if(e.STATUS_ID==3){d="#fdfdfd"}return d==""?"":"color: "+d}});if(a){a.on({load:function(){c.fireEvent("afterload")}})}c.callParent()},load:function(b){var a=this.getViewModel().get("store");if(a){a.removeAll();if(b){a.queryParams=Ext.apply(a.queryParams,b)}a.load()}},getStore:function(){return this.getViewModel().get("store")},reload:function(){var a=this.getViewModel().get("store");if(a){a.reload()}}});Ext.define("informasi.ruangkamartidur.DetilReservasi",{extend:"Ext.form.Panel",alias:"widget.detil-reservasi-form",layout:{type:"vbox",align:"stretch"},title:"Informasi Reservasi",defaultType:"fieldcontainer",defaults:{layout:{type:"hbox"}},bodyPadding:5,readOnly:true,initComponent:function(){var b=this;b.items=[{items:[{xtype:"component",flex:1,bind:{html:"Ruangan: {RKT.RUANGAN} / {RKT.KAMAR} / {RKT.TEMPAT_TIDUR} - {RKT.KELAS}"}}]},{items:[{xtype:"textfield",name:"RESERVASI_NO",emptyText:"[Dibuat oleh Sistem]",readOnly:true,labelAlign:"top",fieldLabel:"NOMOR"},{xtype:"component",flex:1},{xtype:"datefield",name:"TANGGAL",readOnly:true,labelAlign:"top",fieldLabel:"TANGGAL"}]},{items:[{xtype:"textfield",name:"RESERVASI_ATAS_NAMA",emptyText:"[Atas Nama]",readOnly:b.readOnly,labelAlign:"top",fieldLabel:"Atas Nama"},{xtype:"textfield",name:"RESERVASI_KONTAK_INFO",emptyText:"Kontak Info",readOnly:b.readOnly,labelAlign:"top",fieldLabel:"Kontak Info"}]}];b.callParent()},loadRecord:function(d){var c=this.getForm().loadRecord(d);return c}});Ext.define("informasi.ruangkamartidur.Workspace",{extend:"com.Form",alias:"widget.workspace-ruangkamartidur",controller:"workspace-ruangkamartidur",viewModel:{data:{hidden:true,val:"",inproses:false,pasien:undefined,viewConfig:{kosong:true,terpesan:true,semua:true,terisi:true},fullscreen:false},stores:{kunjunganStore:{type:"kunjungan-store"}}},title:"Informasi Ruang Kamar Tidur",layout:"fit",border:false,defaultSelected:1,ruangan:"",formReservasi:true,defaults:{border:false},dockedItems:[{xtype:"container",layout:"hbox",padding:5,dock:"top",items:[{width:320,xtype:"segmentedbutton",reference:"buttons",defaults:{bind:{disabled:"{inproses}"}},items:[{text:"Kosong",value:1,ui:"soft-white",bind:{hidden:"{!viewConfig.kosong}"},listeners:{click:"onRuanganKosong"}},{text:"Terpesan",value:2,ui:"soft-asperages",bind:{hidden:"{!viewConfig.terpesan}"},listeners:{click:"onRuanganTerreservasi"}},{text:"Terisi",value:4,ui:"soft-red",bind:{hidden:"{!viewConfig.terisi}"},listeners:{click:"onRuanganTerisi"}},{text:"Semua",value:3,ui:"soft-cyan",bind:{hidden:"{!viewConfig.semua}"},listeners:{click:"onSemuaRuangan"}}]},{width:200,xtype:"ruangan-mutasi-combo",emptyText:"Pilih Ruangan",reference:"ruangancombo",hideTrigger:false,forceSelection:false,params:{STATUS:1},listeners:{select:"onRuanganSelected",change:"onRuanganChanged"},margin:"0 5 0 5"},{width:150,xtype:"master-kamar-combo",emptyText:"Pilih Kamar",reference:"kamarcombo",hideTrigger:false,forceSelection:false,params:{STATUS:1},listeners:{select:"onKamarSelected",change:"onKamarChanged"},margin:"0 5 0 5"},{width:150,xtype:"referensi-combo",params:{JENIS:19,STATUS:1},firstLoad:true,emptyText:"Pilih Kelas",reference:"kelascombo",hideTrigger:false,forceSelection:false,listeners:{select:"onKelasSelected",change:"onKelasChanged"},margin:"0 5 0 5"},{width:200,xtype:"search-field",emptyText:"Cari pasien berdasarkan Norm / Nama",bind:{hidden:"{hidden}",value:"{val}"},reference:"searchroom",listeners:{search:"onSearch",clear:"onClear"},margin:"0 5 0 0"},{xtype:"button",iconCls:"x-fa fa-users",reference:"pendaftaranantrian",tooltip:"Pendaftaran Antrian Tempat Tidur",handler:"onPendaftaranAntrianTempatTidur"},{xtype:"button",iconCls:"fas fa-procedures",ui:"soft-black",reference:"btndaftarantrian",tooltip:"Daftar Antrian Tempat Tidur",handler:"onDaftarAntrian"},{xtype:"component",flex:1},{xtype:"component",style:"padding: 5px; font-size: 20px; font-weight: bold",hidden:true,bind:{hidden:"{!inproses}"},cls:"x-fa fa-spinner fa-pulse"},{xtype:"component",style:"padding: 5px; font-size: 20px; font-weight: bold",reference:"inforefresh",html:"5"},{xtype:"button",reference:"fullscreenbtn",bind:{tooltip:"{fullscreen ? 'Exit Full Screen' : 'Full Screen'}",iconCls:"{fullscreen ? 'x-fa fa-compress' : 'x-fa fa-expand'}"},handler:"onFullscreen"}]}],items:[{xtype:"ruangkamartidur-data-view",reference:"inforuangkamartidur",listeners:{select:"onSelect",afterload:"onAfterLoad"}}],listeners:{afterrender:"onAfterRender"},setPasien:function(a){this.getViewModel().set("pasien",a)},setViewConfig:function(e){var f=this,d=f.getViewModel();_config=d.get("viewConfig");e=Ext.apply(_config,e);d.set("viewConfig",e);d.notify()}});Ext.define("informasi.ruangkamartidur.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.workspace-ruangkamartidur",autoRefresh:true,autoRefreshTime:30,currentRefreshTime:30,status:1,kamar:0,kelas:0,ruangSelectedIndex:0,onAfterRender:function(){var k=this,f=k.getView(),e=k.getReferences(),j=f.app.xpriv("2201"),g=f.app.xpriv("2202"),i=f.app.xpriv("220301");e.inforuangkamartidur.getViewModel().set("showIdentitasPasien",g);if(!j&&f.formReservasi){f.defaultSelected=3}e.buttons.setValue(f.defaultSelected);var l=e.buttons.down("[value="+f.defaultSelected+"]");l.fireEvent("click",l);if(k.task==undefined){k.task={run:function(){var b=f.app.xpriv("2201");if(!k.getViewModel().get("inproses")){e.inforefresh.update(k.currentRefreshTime)}if(k.currentRefreshTime==0){if(k.autoRefresh&&!k.getViewModel().get("inproses")){e.inforefresh.setVisible(false);k.getViewModel().set("inproses",true);if(!b&&f.formReservasi){var a=e.ruangancombo.getStore();if((a.getCount()-1)==k.ruangSelectedIndex){k.ruangSelectedIndex=0}else{k.ruangSelectedIndex++}e.ruangancombo.select(a.getAt(k.ruangSelectedIndex));k.onRuanganSelected(e.ruangancombo,a.getAt(k.ruangSelectedIndex))}else{e.inforuangkamartidur.reload()}}k.currentRefreshTime=k.autoRefreshTime+1}k.currentRefreshTime--},interval:1000};Ext.TaskManager.start(k.task)}e.ruangancombo.setVisible(f.formReservasi);e.kamarcombo.setVisible(f.formReservasi);e.kelascombo.setVisible(f.formReservasi);e.fullscreenbtn.setVisible(f.formReservasi);e.pendaftaranantrian.setVisible(f.formReservasi&&i);e.btndaftarantrian.setVisible(f.formReservasi&&i);if(f.formReservasi){e.ruangancombo.params.RUANGAN=0;e.ruangancombo.load();e.ruangancombo.doAfterLoad=function(c,a,b){var d=f.app.xpriv("2201");if(!d){k.status=0;k.ruangSelectedIndex=0;e.ruangancombo.select(b.getAt(k.ruangSelectedIndex));k.onRuanganSelected(e.ruangancombo,b.getAt(k.ruangSelectedIndex))}}}},onRuanganTerisi:function(){var c=this,d=c.getReferences();c.getViewModel().set("inproses",true);c.status=3;d.inforuangkamartidur.load({RUANGAN:c.getView().ruangan,KAMAR:c.kamar,KELAS:c.kelas,STATUS:3,PASIEN:""});c.getViewModel().set("hidden",false);this.getViewModel().set("val","")},onSemuaRuangan:function(){var c=this,d=c.getReferences();c.getViewModel().set("inproses",true);c.status=0;d.inforuangkamartidur.load({RUANGAN:c.getView().ruangan,KAMAR:c.kamar,KELAS:c.kelas,STATUS:0,PASIEN:""});c.getViewModel().set("hidden",false);c.getViewModel().set("val","")},onRuanganKosong:function(){var c=this,d=c.getReferences();c.getViewModel().set("inproses",true);c.status=1;d.inforuangkamartidur.load({RUANGAN:c.getView().ruangan,KAMAR:c.kamar,KELAS:c.kelas,STATUS:1,PASIEN:""});c.getViewModel().set("hidden",true);c.getViewModel().set("val","")},onRuanganTerreservasi:function(){var c=this,d=c.getReferences();c.getViewModel().set("inproses",true);c.status=2;d.inforuangkamartidur.load({RUANGAN:c.getView().ruangan,KAMAR:c.kamar,KELAS:c.kelas,STATUS:2});c.getViewModel().set("hidden",true)},onRuanganSelected:function(b,e){var c=this,a=c.getReferences(),d=e?e.get("MUTASI"):"";c.getView().ruangan=d;a.kamarcombo.select(null);a.kamarcombo.params.RUANGAN=d;a.kamarcombo.load();c.onKamarSelected(b,null)},onRuanganChanged:function(b,a){if(a==null){this.getView().ruangan="";this.onRuanganSelected(b,null);this.onKamarSelected(b,null)}},onKamarSelected:function(b,e){var d=this,a=d.getReferences(),c=e?e.get("ID"):"";d.kamar=c;a.inforuangkamartidur.load({RUANGAN:d.getView().ruangan,KAMAR:c,KELAS:d.kelas})},onKamarChanged:function(b,a){if(a==null){this.kamar=0;this.onKamarSelected(b,null)}},onKelasSelected:function(b,e){var c=this,a=c.getReferences(),d=e?e.get("ID"):"";c.kelas=d;a.inforuangkamartidur.load({RUANGAN:c.getView().ruangan,KAMAR:c.kamar,KELAS:d})},onKelasChanged:function(b,a){if(a==null){this.kelas=0;this.onKelasSelected(b,null)}},onSearch:function(e,g){var i=this,f=i.getReferences();i.getViewModel().set("inproses",true);f.inforuangkamartidur.load({RUANGAN:i.getView().ruangan,KAMAR:i.kamar,KELAS:i.kelas,STATUS:i.status,PASIEN:g})},onClear:function(b){this.onSearch(b,"")},onAfterLoad:function(){var a=this;a.getViewModel().set("inproses",false);a.currentRefreshTime=a.autoRefreshTime;a.getReferences().inforefresh.setVisible(true)},onSelect:function(n,f){var j=this,c=j.getViewModel(),k=j.getReferences(),l=j.getView(),m=l.app.xpriv("2201");if(f.get("STATUS_ID")==3){j.doLihatKunjungan(f);return}if(l.formReservasi){if(!m){return}j.autoRefresh=false;k.inforefresh.setVisible(false);l.openDialog("",true,"50%","40%",{xtype:"reservasi-form",ui:"panel-cyan",showCloseButton:true,reference:"reservasiform"},function(p,s){var r=s.down("reservasi-form");if(f.get("RESERVASI_NO")){var o=Ext.create("data.model.Reservasi",{NOMOR:f.get("RESERVASI_NO")});o.load({success:function(u,t){r.loadRecord(u,f)}})}else{var q=Ext.create("data.model.Reservasi",{RUANG_KAMAR_TIDUR:f.get("ID"),STATUS:1,TANGGAL:l.getSysdate()});q.set("NOMOR",null);r.loadRecord(q,f);r.setLoading(true);r.getAntrianPertamaTempatTidur(f.get("RUANGAN_ID"),f.get("KELAS_ID")).then(function(t){r.setLoading(false);var v=l.getReferensi(t.getData(),"PASIEN","NAMA"),u=l.getReferensi(t.getData(),"PEMOHON","KONTAK_HP");r.down("[name=ATAS_NAMA]").setValue(t.get("NORM")+" - "+v);r.down("[name=KONTAK_INFO]").setValue(u);r.down("[name=ATAS_NAMA]").setReadOnly(true);r.down("[name=KONTAK_INFO]").setReadOnly(true);r.setAntrianTempatTidur(t)},function(t){r.setLoading(false);r.down("[name=ATAS_NAMA]").setReadOnly(false);r.down("[name=KONTAK_INFO]").setReadOnly(false)})}r.on({reserved:function(t,u){if(u){l.fireEvent("reserved",t);k.inforuangkamartidur.load()}},batalreservasi:function(){k.inforuangkamartidur.load();s.close()}});if(f.get("STATUS_ID")==1){r.setFormConfig({readOnly:false,reservasi:true,batal:false})}else{r.setFormConfig({readOnly:true,reservasi:false,batal:f.get("NOPEN")?false:true})}s.on("close",function(){j.defaultSettings(f)});r.focus("ATAS_NAMA")})}else{var i=c.get("pasien")?c.get("pasien"):null,d=i?i.get("NORM")+" - "+i.get("NAMA"):"-",a=i.get("KONTAK")?i.get("KONTAK"):[],e="-";if(Ext.isArray(a)){Ext.Array.each(a,function(o){e=o.NOMOR})}if(f.get("STATUS_ID")!=1){if(f.get("STATUS_ID")==2){var g=Ext.create("data.model.Reservasi",{NOMOR:f.get("RESERVASI_NO"),RUANG_KAMAR_TIDUR:f.get("ID"),STATUS:f.get("STATUS_ID"),ATAS_NAMA:f.get("RESERVASI_ATAS_NAMA"),KONTAK_INFO:f.get("RESERVASI_KONTAK_INFO"),TANGGAL:f.get("RESERVASI_TANGGAL")});l.fireEvent("reserved",g);j.defaultSettings(f);return}else{j.defaultSettings(f);return}}j.autoRefresh=false;k.inforefresh.setVisible(false);var b=f.get("RUANGAN")+" / "+f.get("KAMAR")+" / "+f.get("TEMPAT_TIDUR")+" - "+f.get("KELAS"),g=Ext.create("data.model.Reservasi",{RUANG_KAMAR_TIDUR:f.get("ID"),STATUS:1,ATAS_NAMA:d,KONTAK_INFO:e,TANGGAL:l.getSysdate()});g.showError=true;g.animateTarget=n;g.scope=j;l.showMessageBox({title:"Reservasi",message:"Anda yakin ingin reservasi ruangan "+b+" ?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:n,fn:function(o){if(o==="yes"){g.save({callback:function(p,r,q){if(q){l.notifyMessage("Reservasi berhasil<br/> Nomor: "+p.get("NOMOR"));l.fireEvent("reserved",p);j.defaultSettings(f)}}})}else{j.defaultSettings(f)}}})}},doLihatKunjungan:function(e){var d=this,c=d.getViewModel(),a=d.getView(),b=c.get("kunjunganStore"),f=a.app.xpriv("110802",false);if(f){b.setQueryParams({NOPEN:e.get("NOPEN"),STATUS:1});b.load({callback:function(k,j,l){if(l){if(Ext.isArray(k)){if(k.length>0){var m=k[0],i=Ext.create("data.model.Pendaftaran",a.getReferensi(m.data,"PENDAFTARAN")),g=Ext.create("data.model.Pasien",a.getReferensi(i.data,"PASIEN"));a.openWindow({header:false,border:false,modal:true,maximized:true,constrain:a,layout:"fit",items:[{xtype:"layanan-workspace",ui:"panel-cyan",iconCls:"x-fa fa-file-text-o",showCloseButton:true}]},function(o,q){var p=q.down("layanan-workspace");p.on({reopen:function(r){q.close();d.doLihat(r)}});var n=new Ext.util.DelayedTask(function(){p.load(g,i,m)});n.delay(100)})}}}}})}},onFullscreen:function(b){var d=this,c=d.getViewModel(),a=d.getView();if(!c.get("fullscreen")){a.openDialog("",true,0,0,{xtype:"workspace-ruangkamartidur",ui:"panel-purple",iconCls:"x-fa fa-bed",showCloseButton:true},function(i,g){d.autoRefresh=false;var j=g.down("workspace-ruangkamartidur"),f=j.down("[reference=fullscreenbtn]");f.setHidden(true);g.on({beforeclose:function(){d.autoRefresh=true;c.set("fullscreen",false)}})})}},privates:{defaultSettings:function(f){var d=this;if(d.getReferences){var e=d.getReferences();d.autoRefresh=true;d.currentRefreshTime=d.autoRefreshTime;if(e){e.inforefresh.setVisible(true);e.inforuangkamartidur.deselect(f)}}}},destroy:function(){Ext.TaskManager.stop(this.task);this.callParent()},onPendaftaranAntrianTempatTidur:function(){var a=this;view=a.getView();view.openDialog("",true,900,650,{xtype:"pendaftaran-antrian-tempattidur-workspace",ui:"panel-blue",showCloseButton:true,title:"Pendaftaran Antrian Tempat Tidur"},function(d,c){var b=c.down("pendaftaran-antrian-tempattidur-workspace");b.load();b.on("save",function(e){c.close()})})},onDaftarAntrian:function(a){var b=this;view=b.getView();view.openDialog("",true,0,0,{xtype:"pendaftaran-antrian-tempattidur-grid",ui:"panel-black",iconCls:a.iconCls,showCloseButton:true,title:"Pendaftaran Antrian Tempat Tidur"},function(d,c){},a)}});Ext.define("informasi.tempattidur.DataView",{extend:"Ext.view.View",xtype:"informasi-tempattidur-dataview",viewModel:{stores:{store:{type:"referensi-store"}}},loadMask:false,autoScroll:true,cls:"laporan-main laporan-dataview",bind:{store:"{store}"},style:"background:#27262b;",itemSelector:"div.thumb-wrap-tidur",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="thumb-wrap-tidur" style="min-height: 30px;text-align:center">','<div class="thumb-title-container" style="padding-right:10px;padding-left:30px;width:250px">','<div class="thumb-title-medium" style="text-align:center"><strong style="font-size:16px;min-height:30px;vertical-align:middle;line-height:2;font-weight:800;">{KAMAR}</strong></div>',"</div>",'<div class="thumb-title-container" style="padding-right:10px;padding-bottom:4px">','<div style="text-align:left;border:0px #CCC solid;border-radius:0px 5px 5px 0px">','<div class="w3-border" style="background:#F07886;width:200px;height:30px;border-radius:0px 5px 5px 0px">','<div class="w3-grey" style="background:#00aeae;color: white;height:30px;width:{PERC_KOSONG}%;float:left;text-align:center;border-radius:0px 5px 5px 0px;line-height:2;font-size:16px;font-weight:800;">{KOSONG}</div>','<div class="w3-grey" style="background:#F07886;height:30px;width:{PERC_TERISI}%;float:right;text-align:center;border-radius:0px 5px 5px 0px;line-height:2;font-size:16px;font-weight:800;">{TERISI}</div>',"</div>","</div>","</div>","</div>","</tpl>",{getInfo:function(e){var g=e.STATUS_ID==2?e.RESERVASI_NO:(e.STATUS_ID==3?e.NORM:""),i=e.STATUS_ID==2?e.RESERVASI_ATAS_NAMA:(e.STATUS_ID==3?e.NAMA:"");if(e.STATUS_ID==3){lpad=Ext.String.leftPad(g,8,"0"),g=Ext.String.insert(Ext.String.insert(Ext.String.insert(lpad,".",2),".",5),".",8)}var f=e.STATUS_ID==2||e.STATUS_ID==3?g+" - "+i:"";return f}}),initComponent:function(){var c=this,d=c.getViewModel().get("store");if(d){d.on({load:function(){c.fireEvent("afterload")}})}c.callParent()},onLoadRecord:function(a){var d=this,c=d.getViewModel().get("store");if(c){c.setQueryParams({BAR_RUANGAN:a});c.load()}},getStore:function(){return this.getViewModel().get("store")},reload:function(){var b=this.getViewModel().get("store");if(b){b.reload()}}});Ext.define("informasi.tempattidur.DetilView",{extend:"Ext.view.View",xtype:"informasi-tempattidur-detilview",viewModel:{stores:{store:{type:"ruangkamartidur-store"}}},layout:{type:"vbox",align:"stretch"},loadMask:false,autoScroll:true,cls:"laporan-main laporan-dataview",bind:{store:"{store}"},itemSelector:"div.thumb-wrap",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="thumb-wrap" style="text-align:center;width:33%;display:grid;padding:15px;">','<a class="thumb" href="#" style="background-image:url(classic/resources/images/{BED_STATUS}.png);background-size: cover;background-position: center;background-repeat: no-repeat;">','<div class="thumb-title-container" style="float:none">','<div class="thumb-title">','<img src="classic/resources/images/{STATUS_BED}.png" />',"</div>",'<div class="thumb-title-medium" style="color:{COLOR}"><strong>{TEMPAT_TIDUR}</strong></div>','<div class="thumb-title-small" style="color:{COLOR}"><strong>{STATUS_INFO}</strong></div>',"</div>","</a>","</div>","</tpl>"),initComponent:function(){var c=this,d=c.getViewModel().get("store");if(d){d.on({load:function(){c.fireEvent("afterload")}})}c.callParent()},onLoadRecord:function(a){var d=this,c=d.getViewModel().get("store");if(c){c.setQueryParams({INFO_RUANG_KAMAR:a});c.load()}},getStore:function(){return this.getViewModel().get("store")},reload:function(){var b=this.getViewModel().get("store");if(b){b.reload()}}});Ext.define("informasi.tempattidur.Header",{extend:"com.Form",xtype:"informasi-tempattidur-header",viewModel:{stores:{store:{type:"instansi-store"}},data:{datapegawai:undefined}},layout:{type:"vbox",align:"center"},items:[{xtype:"image",style:"border: 0px solid #eaeaea ",bind:{src:"classic/resources/images/{instansi}.png"},width:90,height:90,alt:"no-image",margin:"10 10 0 10"},{xtype:"component",style:"font-size:28px;font-weight:800;padding-top:15px; padding-bottom:5px;background:#27262b;color:#dbdddf;",html:"INFORMASI TEMPAT TIDUR"}],onLoadRecord:function(){var b=this,a=b.getViewModel().get("store");a.load()}});Ext.define("informasi.tempattidur.Info",{extend:"com.Form",xtype:"informasi-tempattidur-info",layout:{type:"vbox",align:"stretch"},fieldDefaults:{labelAlign:"top"},items:[{xtype:"fieldcontainer",fieldLabel:"Keterangan",labelStyle:"color: white;",style:"margin-top:0px;font-size:16px;height:80px;margin-bottom:0px;padding-bottom:3px;padding-top:3px;",layout:{type:"hbox"},items:[{xtype:"component",html:"Kosong",style:"background:#00aeae;color: white;width:100px;font-size:16px;margin-left:5px;padding:10px;text-align:center"},{xtype:"component",html:"Terisi",style:"background:#F07886;width:100px;font-size:16px;margin-right:5px;padding:10px;text-align:center"}]}],load:function(){}});Ext.define("informasi.tempattidur.Ruangan",{extend:"com.Form",xtype:"informasi-tempattidur-ruangan",controller:"informasi-tempattidur-ruangan",viewModel:{data:{formConfig:{disabledField:true}}},layout:{type:"vbox",align:"stretch"},flex:1,border:true,ruangans:undefined,initComponent:function(){var a=this;a.items=[{xtype:"ruangan-list",reference:"ruanganlist",ui:"panel-cyan",hideHeaders:true,ruanganAkses:false,checkboxModel:true,flex:1,selModel:{selType:"checkboxmodel",mode:"MULTI",checkOnly:true},listeners:{select:"onSelectRuangan",deselect:"onDeselectRuangan"}},{xtype:"toolbar",ui:"toolbar-blue",items:["->",{xtype:"combobox",reference:"waktuperpindahan",fieldLabel:"Waktu Perpindahan Ruangan",labelWidth:180,value:15,width:253,store:{data:[{ID:5},{ID:10},{ID:15},{ID:20},{ID:25},{ID:30}]},displayField:"ID",valueField:"ID"},{xtype:"component",html:"detik"},{text:"Mulai",listeners:{click:"onMulai"}}]}];a.callParent()},onLoadRecord:function(d){var b=this,c=b.down("ruangan-list"),a=b.down("[reference=waktuperpindahan]");c.setParams({TREE:0,JENIS_KUNJUNGAN:3});a.on("select",function(e,f){b.waktuPerpindahan=f.get("ID")});c.loadStore();c.doAfterLoad=function(e,f){b.ruangans=f;b.waktuPerpindahan=a.getSelection().get("ID")}}});Ext.define("informasi.tempattidur.RuanganController",{extend:"Ext.app.ViewController",alias:"controller.informasi-tempattidur-ruangan",ruangans:undefined,onSelectRuangan:function(a,b){b.set("checked",true)},onDeselectRuangan:function(a,b){b.set("checked",false)},onMulai:function(j){var f=this,i=f.getView(),g=f.getReferences(),c=[],d=g.ruanganlist,e=g.waktuperpindahan,b=e.getSelection().get("ID"),a=d.getSelection();Ext.Array.each(a,function(k){c.push(k)});if(c.length==0){i.notifyMessage("Silahkan Pilih Salah Satu Ruangan Yang Ingin Ditampilkan");return}i.openDialog("",true,"100%","100%",{xtype:"informasi-tempattidur-workspace",ui:"panel-cyan",scrollable:true},function(m,l){var k=l.down("informasi-tempattidur-workspace");k.load(c,b);k.on("success",function(n){i.refresh();l.close()})},j,true,false)}});Ext.define("informasi.tempattidur.Update",{extend:"com.Form",xtype:"informasi-tempattidur-update",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="thumb-wrap-tidur" style="min-height: 95px">','<a class="thumb" href="#">','<div class="thumb-icon-tidur"></div>','<div class="thumb-title-container">','<div class="thumb-title-medium" style="white-space:normal !important;"><strong>tes</strong></div>',"</div>","</a>","</div>","</tpl>")});Ext.define("informasi.tempattidur.Workspace",{extend:"com.Form",xtype:"informasi-tempattidur-workspace",controller:"informasi-tempattidur-workspace",viewModel:{data:{ruangans:[],refreshTime:0,infreshTime:0,instansi:undefined,infoKelasKamar:"",info:{teks:""}},stores:{store:{type:"instansi-store"},storeKamar:{type:"ruang-kamar-store"},infoStore:{type:"info-teks-store",queryParams:{JENIS:3,PUBLISH:1,STATUS:1}}}},layout:{type:"vbox",align:"stretch"},defaults:{border:false},border:false,margin:0,bodyPadding:0,initComponent:function(){var a=this;a.items=[a.layoutHeader(),a.layoutContent(),a.layoutFooter()];a.callParent()},layoutHeader:function(){var a=this;return{layout:{type:"hbox",align:"middle"},border:false,height:50,bodyStyle:"background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#356aa0), color-stop(100%,#356aa0));",items:[{xtype:"image",bind:{src:"classic/resources/images/{instansi}.png"},id:"idImage",width:40,border:false,bodyStyle:"background-color:transparent;",padding:{left:5,right:5}},{flex:1,bind:{data:{items:"{store.data.items}"}},height:20,tpl:new Ext.XTemplate('<tpl for="items">',"{data.REFERENSI.PPK.NAMA}","</tpl>"),border:false,bodyStyle:"background-color:transparent; font-size: 18px; font-weight:800; color: white; "},{xtype:"label",id:"tgl",text:a.getDateIndo(),width:290,border:false,style:"background-color:transparent; font-size: 16px; color: white; "},{bind:{html:"{refreshTime}"},width:60,border:false,height:50,bodyStyle:"background-color:#0d3050; padding-top: 17px; text-align:center; font-family: Walrus Gumbo NF; font-size: 23px;  color: white;"}]}},layoutContent:function(){var a=this;return{flex:1,layout:{type:"hbox",align:"stretch"},defaults:{flex:1,margin:"0 1 0 1"},border:false,reference:"informasi",items:[{flex:1,border:false,layout:{type:"vbox",align:"stretch"},defaults:{bodyStyle:"background-color:#27262b"},items:[{border:false,xtype:"informasi-tempattidur-header"},{flex:1,reference:"barinfo",border:false,xtype:"informasi-tempattidur-dataview"},{border:false,style:"border-top:1px #DDD solid",xtype:"informasi-tempattidur-info"}]},{flex:2,border:false,layout:{type:"vbox",align:"stretch"},bodyPadding:"20",bodyStyle:"background-color:#303031",items:[{xtype:"component",bind:{html:"{infoKelasKamar}"},style:"padding:15px;font-size:21px;text-align:center;color:#fdb511;background-color:#323233;border-radius:4px;margin-top:20px"},{flex:1,reference:"dataview",style:"margin-top:10px;background-color:#303031",xtype:"informasi-tempattidur-detilview",viewConfig:{loadMask:false}}]}]}},layoutFooter:function(){return{xtype:"component",style:"background: #4f5152",height:35,bind:{html:'<marquee style="padding-top: 6px; font-weight: bold; font-size: 17px; font-family: Alliance; line-height: 21px">{info.teks}</marquee>'}}},getDateIndo:function(){return Ext.Date.format(new Date(),"l, d F Y H:i:s")},refreshInfoTanggal:function(){Ext.getCmp("tgl").setText(this.getDateIndo())},load:function(f,i){var e=this,c=e.down("informasi-tempattidur-header"),a=e.getController(),d=e.getViewModel(),g=d.get("storeKamar");d.set("ruangans",f);d.set("refreshTime",i);d.set("infreshTime",i);c.onLoadRecord();var b="";f.forEach(function(j){if(b==""){b=j.get("ID")}else{b=b+","+j.get("ID")}});if(g){g.setQueryParams({INFO_KAMAR:b});g.load({callback:function(m,j,l){if(l){var k=Ext.create("data.model.InfoTeks",{ID:1});a.refreshTimeRuangan=i;a.currentRefreshTimeRuangan=i;a.mulai(m);k.load({callback:function(p,n,o){if(o){d.set("infoTeks",p.get("TEKS"))}}})}}})}},listeners:{afterrender:"onAfterRender"},runLogo:function(){if(this.deg==360){this.deg=0}else{this.deg+=5}Ext.getCmp("idImage").setStyle("-webkit-transform: rotateY("+this.deg+"deg)")},onSetIdKamarKelas:function(){var c=this,b=c.getViewModel().get("storeKamar"),d=b.getData(),a="";b.each(function(e){a.push(e.get("ID"))});return 1}});Ext.define("informasi.tempattidur.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.informasi-tempattidur-workspace",ruanganLastIdx:0,refreshTimeRuangan:0,currentRefreshTimeRuangan:0,onAfterRender:function(){var d=this,b=d.getViewModel(),a=b.get("store"),c=Ext.getStore("instansi");if(c){b.set("store",c);new Ext.util.DelayedTask(function(){b.set("instansi",c.getAt(0).get("PPK"))}).delay(1000)}else{a.doAfterLoad=function(e,g,f,i){if(i){if(g.length>0){b.set("instansi",g[0].get("PPK"))}}};a.load()}d.reloadInfoTeks();if(d.taskInfo==undefined){d.taskInfo={interval:15000,run:function(){d.reloadInfoTeks()}}}Ext.TaskManager.start(d.taskInfo)},mulai:function(g){var d=this,a=d.getView(),f=0,b=d.getReferences(),c=d.getViewModel(),e=c.get("ruangans");ruanganKamar=c.get("storeKamar"),vkamar=ruanganKamar.getData();c.set("refreshTime",d.autoRefreshTime);if(d.task==undefined){d.task={run:function(){c.set("refreshTime",d.currentRefreshTimeRuangan);if(d.currentRefreshTimeRuangan==d.refreshTimeRuangan){var i="";b.dataview.onLoadRecord(g[d.ruanganLastIdx].get("ID_RUANGAN"));c.set("infoKelasKamar",g[d.ruanganLastIdx].get("NM_RUANGAN")+" - "+g[d.ruanganLastIdx].get("NM_KELAS")+" - "+g[d.ruanganLastIdx].get("NM_KAMAR"));e.forEach(function(j){if(i==""){i=j.get("ID")}else{i=i+","+j.get("ID")}});b.barinfo.onLoadRecord(i);d.ruanganLastIdx++}if(d.ruanganLastIdx>g.length-1){d.ruanganLastIdx=0}if(d.currentRefreshTimeRuangan==0){d.currentRefreshTimeRuangan=d.refreshTimeRuangan+1}d.currentRefreshTimeRuangan--;d.getView().refreshInfoTanggal()},interval:1000};Ext.TaskManager.start(d.task)}},reloadInfoTeks:function(){var c=this,b=c.getViewModel(),a=b.get("infoStore");a.load({callback:function(e,d,g){var f=[];Ext.Array.each(e,function(k){var i=k.get("WARNA")?"#"+k.get("WARNA"):"",j=k.get("TEKS");f.push("<span style='color: "+i+";'>"+j+"</span>")});b.set("info.teks",f.join(" # "))}})},destroy:function(){var b=this,a=b.getView();Ext.TaskManager.stop(b.task);Ext.TaskManager.stop(b.taskInfo);b.callParent()}});